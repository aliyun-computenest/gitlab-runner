{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Gitlab Runner \u514d\u8d23\u58f0\u660e\uff1a \u672c\u670d\u52a1\u7531\u7b2c\u4e09\u65b9\u63d0\u4f9b\uff0c\u6211\u4eec\u5c3d\u529b\u786e\u4fdd\u5176\u5b89\u5168\u6027\u3001\u51c6\u786e\u6027\u548c\u53ef\u9760\u6027\uff0c\u4f46\u65e0\u6cd5\u4fdd\u8bc1\u5176\u5b8c\u5168\u514d\u4e8e\u6545\u969c\u3001\u4e2d\u65ad\u3001\u9519\u8bef\u6216\u653b\u51fb\u3002\u56e0\u6b64\uff0c\u672c\u516c\u53f8\u5728\u6b64\u58f0\u660e\uff1a\u5bf9\u4e8e\u672c\u670d\u52a1\u7684\u5185\u5bb9\u3001\u51c6\u786e\u6027\u3001\u5b8c\u6574\u6027\u3001\u53ef\u9760\u6027\u3001\u9002\u7528\u6027\u4ee5\u53ca\u53ca\u65f6\u6027\u4e0d\u4f5c\u4efb\u4f55\u9648\u8ff0\u3001\u4fdd\u8bc1\u6216\u627f\u8bfa\uff0c\u4e0d\u5bf9\u60a8\u4f7f\u7528\u672c\u670d\u52a1\u6240\u4ea7\u751f\u7684\u4efb\u4f55\u76f4\u63a5\u6216\u95f4\u63a5\u7684\u635f\u5931\u6216\u635f\u5bb3\u627f\u62c5\u4efb\u4f55\u8d23\u4efb\uff1b\u5bf9\u4e8e\u60a8\u901a\u8fc7\u672c\u670d\u52a1\u8bbf\u95ee\u7684\u7b2c\u4e09\u65b9\u7f51\u7ad9\u3001\u5e94\u7528\u7a0b\u5e8f\u3001\u4ea7\u54c1\u548c\u670d\u52a1\uff0c\u4e0d\u5bf9\u5176\u5185\u5bb9\u3001\u51c6\u786e\u6027\u3001\u5b8c\u6574\u6027\u3001\u53ef\u9760\u6027\u3001\u9002\u7528\u6027\u4ee5\u53ca\u53ca\u65f6\u6027\u627f\u62c5\u4efb\u4f55\u8d23\u4efb\uff0c\u60a8\u5e94\u81ea\u884c\u627f\u62c5\u4f7f\u7528\u540e\u679c\u4ea7\u751f\u7684\u98ce\u9669\u548c\u8d23\u4efb\uff1b\u5bf9\u4e8e\u56e0\u60a8\u4f7f\u7528\u672c\u670d\u52a1\u800c\u4ea7\u751f\u7684\u4efb\u4f55\u635f\u5931\u3001\u635f\u5bb3\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u76f4\u63a5\u635f\u5931\u3001\u95f4\u63a5\u635f\u5931\u3001\u5229\u6da6\u635f\u5931\u3001\u5546\u8a89\u635f\u5931\u3001\u6570\u636e\u635f\u5931\u6216\u5176\u4ed6\u7ecf\u6d4e\u635f\u5931\uff0c\u4e0d\u627f\u62c5\u4efb\u4f55\u8d23\u4efb\uff0c\u5373\u4f7f\u672c\u516c\u53f8\u4e8b\u5148\u5df2\u88ab\u544a\u77e5\u53ef\u80fd\u5b58\u5728\u6b64\u7c7b\u635f\u5931\u6216\u635f\u5bb3\u7684\u53ef\u80fd\u6027\uff1b\u6211\u4eec\u4fdd\u7559\u4e0d\u65f6\u4fee\u6539\u672c\u58f0\u660e\u7684\u6743\u5229\uff0c\u56e0\u6b64\u8bf7\u60a8\u5728\u4f7f\u7528\u672c\u670d\u52a1\u524d\u5b9a\u671f\u68c0\u67e5\u672c\u58f0\u660e\u3002\u5982\u679c\u60a8\u5bf9\u672c\u58f0\u660e\u6216\u672c\u670d\u52a1\u5b58\u5728\u4efb\u4f55\u95ee\u9898\u6216\u7591\u95ee\uff0c\u8bf7\u8054\u7cfb\u6211\u4eec\u3002 \u6982\u8ff0 \u6781\u72d0GitLab Runner \u8fd0\u884c\u5b9a\u4e49\u5728\u6781\u72d0GitLab \u4e2d\u7684 CI/CD \u4f5c\u4e1a\u3002\u6781\u72d0GitLab Runner \u53ef\u4ee5\u4ee5\u5355\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u8fd0\u884c\uff0c\u4e14\u6ca1\u6709\u7279\u5b9a\u4e8e\u8bed\u8a00\u7684\u8981\u6c42\u3002 \u6781\u72d0GitLab Runner \u7684\u7279\u6027\u5982\u4e0b\u3002 \u5e76\u884c\u8fd0\u884c\u591a\u4e2a\u4f5c\u4e1a\u3002 \u5728\u591a\u4e2a\u670d\u52a1\u5668\u4e0a\u4f7f\u7528\u591a\u4e2a\u4ee4\u724c\uff08\u751a\u81f3\u6bcf\u4e2a\u9879\u76ee\uff09\u3002 \u9650\u5236\u6bcf\u4e2a\u4ee4\u724c\u7684\u5e76\u53d1\u4f5c\u4e1a\u6570\u3002 \u4f5c\u4e1a\u53ef\u4ee5\u5728\u4ee5\u4e0b\u73af\u5883\u8fd0\u884c\u4f5c\u4e1a\uff1a \u672c\u5730\u3002 \u4f7f\u7528 Docker \u5bb9\u5668\u3002 \u4f7f\u7528 Docker \u5bb9\u5668\u5e76\u901a\u8fc7 SSH \u6267\u884c\u4f5c\u4e1a\u3002 \u5728\u4e0d\u540c\u7684\u4e91\u548c\u865a\u62df\u5316\u5e73\u53f0\u4e0a\u4f7f\u7528\u5f39\u6027\u4f38\u7f29\u7684 Docker \u5bb9\u5668\u3002 \u8fde\u63a5\u5230\u8fdc\u7a0b SSH \u670d\u52a1\u5668\u3002 \u4f7f\u7528 Go \u8bed\u8a00\u7f16\u5199\u5e76\u4f5c\u4e3a\u5355\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u5206\u53d1\uff0c\u6ca1\u6709\u4efb\u4f55\u5176\u5b83\u9700\u6c42\u3002 \u652f\u6301 Bash\u3001PowerShell Core \u548c Windows PowerShell\u3002 \u9002\u7528\u4e8e GNU/Linux\u3001macOS \u548c Windows\uff08\u53ef\u4ee5\u8fd0\u884c Docker \u7684\u51e0\u4e4e\u4efb\u4f55\u73af\u5883\uff09\u3002 \u5141\u8bb8\u81ea\u5b9a\u4e49\u4f5c\u4e1a\u8fd0\u884c\u73af\u5883\u3002 \u65e0\u9700\u91cd\u542f\u5373\u53ef\u81ea\u52a8\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u3002 \u6613\u4e8e\u4f7f\u7528\u7684\u8bbe\u7f6e\uff0c\u652f\u6301 Docker\u3001Docker-SSH\u3001Parallels \u6216 SSH \u8fd0\u884c\u73af\u5883\u3002 \u542f\u7528\u7f13\u5b58 Docker \u5bb9\u5668\u3002 \u8f7b\u677e\u5b89\u88c5\u4e3a GNU/Linux\u3001macOS \u548c Windows \u7684\u670d\u52a1\u3002 \u5d4c\u5165\u5f0f Prometheus \u6307\u6807 HTTP \u670d\u52a1\u5668\u3002 \u652f\u6301\u88ab\u76d1\u63a7\uff0c\u5e76\u5c06 Prometheus \u6307\u6807\u548c\u5176\u4ed6\u7279\u5b9a\u4f5c\u4e1a\u7684\u6570\u636e\u4f20\u9012\u7ed9\u6781\u72d0GitLab\u3002 \u672c\u670d\u52a1\u53ef\u57fa\u4e8e\u963f\u91cc\u4e91\u5bb9\u5668\u865a\u62df\u8282\u70b9\u7684\u529f\u80fd\u6781\u5feb\u901f\u5730\u7533\u8bf7runner pod\uff0c\u4e14\u6781\u5927\u51cf\u5c11\u6210\u672c\u3002\u9ed8\u8ba4\u7533\u8bf7\u7684\u865a\u62df\u8282\u70b9\u7c7b\u578b\u4e3a\uff1a \"alibabacloud.com/compute-qos\" = \"best-effort\" \"alibabacloud.com/compute-class\" = \"general-purpose\" \u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u6781\u72d0GitLab Runner \u7684\u7cfb\u7edf\u9700\u6c42\u914d\u7f6e\u53d6\u51b3\u4e8e\uff1a CI/CD \u4f5c\u4e1a\u6240\u9700\u7684 CPU \u8d1f\u8f7d\u3002 CI/CD \u4f5c\u4e1a\u6240\u9700\u7684\u5185\u5b58\u4f7f\u7528\u91cf\u3002 CI/CD \u4f5c\u4e1a\u7684\u5e76\u53d1\u6570\u91cf\u3002 \u5f00\u53d1\u4e2d\u7684\u9879\u76ee\u6570\u91cf\u3002 \u9884\u671f\u540c\u65f6\u5de5\u4f5c\u7684\u5f00\u53d1\u4eba\u5458\u6570\u91cf\u3002 \u524d\u63d0\u6761\u4ef6 \u90e8\u7f72Gitlab Runner\u793e\u533a\u7248\u670d\u52a1\u5b9e\u4f8b\uff0c\u9700\u8981\u5bf9\u90e8\u5206\u963f\u91cc\u4e91\u8d44\u6e90\u8fdb\u884c\u8bbf\u95ee\u548c\u521b\u5efa\u64cd\u4f5c\u3002\u56e0\u6b64\u60a8\u7684\u8d26\u53f7\u9700\u8981\u5305\u542b\u5982\u4e0b\u8d44\u6e90\u7684\u6743\u9650\u3002 \u8bf4\u660e \uff1a\u5f53\u60a8\u7684\u8d26\u53f7\u662fRAM\u8d26\u53f7\u65f6\uff0c\u624d\u9700\u8981\u6dfb\u52a0\u6b64\u6743\u9650\u3002 \u6743\u9650\u7b56\u7565\u540d\u79f0 \u5907\u6ce8 AliyunECSFullAccess \u7ba1\u7406\u4e91\u670d\u52a1\u5668\u670d\u52a1\uff08ECS\uff09\u7684\u6743\u9650 AliyunVPCFullAccess \u7ba1\u7406\u4e13\u6709\u7f51\u7edc\uff08VPC\uff09\u7684\u6743\u9650 AliyunROSFullAccess \u7ba1\u7406\u8d44\u6e90\u7f16\u6392\u670d\u52a1\uff08ROS\uff09\u7684\u6743\u9650 AliyunComputeNestUserFullAccess \u7ba1\u7406\u8ba1\u7b97\u5de2\u670d\u52a1\uff08ComputeNest\uff09\u7684\u7528\u6237\u4fa7\u6743\u9650 AliyunComputeOSSFullAccess \u7ba1\u7406Oss\u7684\u6743\u9650\u6743\u9650 AliyunCSFullAccess \u7ba1\u7406\u5bb9\u5668\u670d\u52a1(CS)\u7684\u6743\u9650 \u8ba1\u8d39\u8bf4\u660e \u793e\u533a\u7248\u5728\u8ba1\u7b97\u5de2\u90e8\u7f72\u7684\u8d39\u7528\u4e3b\u8981\u6d89\u53ca\uff1a \u6240\u9009vCPU\u4e0e\u5185\u5b58\u89c4\u683c \u7cfb\u7edf\u76d8\u7c7b\u578b\u53ca\u5bb9\u91cf \u516c\u7f51\u5e26\u5bbd \u90e8\u7f72\u67b6\u6784 \u90e8\u7f72\u53c2\u6570\u8bf4\u660e \u60a8\u5728\u521b\u5efa\u670d\u52a1\u5b9e\u4f8b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u914d\u7f6e\u670d\u52a1\u5b9e\u4f8b\u4fe1\u606f\u3002\u4e0b\u6587\u4ecb\u7ecdJupyterhub\u670d\u52a1\u5b9e\u4f8b\u8f93\u5165\u53c2\u6570\u7684\u8be6\u7ec6\u4fe1\u606f,\u5206\u4e3a\u5df2\u6709ack\u96c6\u7fa4\u548c\u65b0\u5efaack\u96c6\u7fa4\u4e24\u79cd\u3002 \u5df2\u6709ack\u96c6\u7fa4 \u662f\u5426\u65b0\u5efaack\u96c6\u7fa4\u53c2\u6570\u9009\u62e9\u5426\u65f6\uff0c\u4ee3\u8868\u73b0\u5728\u5df2\u6709ack\u96c6\u7fa4\uff0c\u6b64\u65f6\u9700\u8981\u586b\u5199\u4ee5\u4e0b\u53c2\u6570\u3002 \u53c2\u6570\u7ec4 \u53c2\u6570\u9879 \u793a\u4f8b \u8bf4\u660e \u670d\u52a1\u5b9e\u4f8b\u540d\u79f0 test \u5b9e\u4f8b\u7684\u540d\u79f0 \u5730\u57df \u534e\u4e1c1\uff08\u676d\u5dde\uff09 \u9009\u4e2d\u670d\u52a1\u5b9e\u4f8b\u7684\u5730\u57df\uff0c\u5efa\u8bae\u5c31\u8fd1\u9009\u4e2d\uff0c\u4ee5\u83b7\u53d6\u66f4\u597d\u7684\u7f51\u7edc\u5ef6\u65f6\u3002 \u662f\u5426\u65b0\u5efaack\u96c6\u7fa4 \u662f\u5426\u65b0\u5efaack\u96c6\u7fa4 \u5426 \u9009\u62e9\u5426\u4ee3\u8868\u5df2\u6709ack\u96c6\u7fa4\uff0c\u4e0d\u7528\u65b0\u5efa \u662f\u5426\u65b0\u5efaack\u96c6\u7fa4 K8s\u96c6\u7fa4ID ccde6deb0f612402786e611a7e1230d \u6839\u636e\u5730\u57df\u9009\u62e9\u5730\u57df\u4e2d\u7528\u6237\u5df2\u6709\u7684\u96c6\u7fa4id \u5e94\u7528\u914d\u7f6e namespace gitlab-runner helm\u5e94\u7528\u5de5\u4f5c\u7684\u547d\u540d\u7a7a\u95f4\u3002 \u5e94\u7528\u914d\u7f6e Helm \u914d\u7f6e {} helm\u7684\u914d\u7f6e\u8be6\u7ec6\u53c2\u8003https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml\uff5c \u65b0\u5efaack\u96c6\u7fa4 \u53c2\u6570\u7ec4 \u53c2\u6570\u9879 \u793a\u4f8b \u8bf4\u660e \u670d\u52a1\u5b9e\u4f8b\u540d\u79f0 test \u5b9e\u4f8b\u7684\u540d\u79f0 \u5730\u57df \u534e\u4e1c1\uff08\u676d\u5dde\uff09 \u9009\u4e2d\u670d\u52a1\u5b9e\u4f8b\u7684\u5730\u57df\uff0c\u5efa\u8bae\u5c31\u8fd1\u9009\u4e2d\uff0c\u4ee5\u83b7\u53d6\u66f4\u597d\u7684\u7f51\u7edc\u5ef6\u65f6\u3002 \u662f\u5426\u65b0\u5efaack\u96c6\u7fa4 \u662f \u9009\u62e9\u662f\u4ee3\u8868\u65b0\u5efaack\u96c6\u7fa4 \u4ed8\u8d39\u7c7b\u578b\u914d\u7f6e \u4ed8\u8d39\u7c7b\u578b \u6309\u91cf\u4ed8\u8d39 \u6216 \u5305\u5e74\u5305\u6708 \u57fa\u7840\u914d\u7f6e \u53ef\u7528\u533a \u53ef\u7528\u533aI \u5730\u57df\u4e0b\u7684\u4e0d\u540c\u53ef\u7528\u533a\u57df \u57fa\u7840\u914d\u7f6e \u4e13\u6709\u7f51\u7edcVPC\u5b9e\u4f8bID vpc-xxx \u9009\u62e9\u5730\u57df\u4e0b\u53ef\u7528\u7684vpc,\u4e0d\u5b58\u5728\u53ef\u4ee5\u65b0\u5efa \u57fa\u7840\u914d\u7f6e \u4ea4\u6362\u673a\u5b9e\u4f8bID vsw-xxx \u9009\u62e9vpc\u4e0b\u7684vsw\uff0c\u8fd9\u4e2avsw\u7b5b\u9009\u4f1a\u53d7\u4e0a\u9762\u4e0d\u540c\u53ef\u7528\u533a\u57df\u5f71\u54cd\uff0c\u4e0d\u5b58\u5728\u53ef\u4ee5\u65b0\u5efa \u57fa\u7840\u914d\u7f6e \u5b9e\u4f8b\u5bc6\u7801 * * \u8bbe\u7f6e\u5b9e\u4f8b\u5bc6\u7801\u3002\u957f\u5ea68~30\u4e2a\u5b57\u7b26\uff0c\u5fc5\u987b\u5305\u542b\u4e09\u9879\uff08\u5927\u5199\u5b57\u6bcd\u3001\u5c0f\u5199\u5b57\u6bcd\u3001\u6570\u5b57\u3001()~!@#$%^&*-+={}[]:;'<>,.?/ \u4e2d\u7684\u7279\u6b8a\u7b26\u53f7\uff09 Kubernetes\u914d\u7f6e Worker\u8282\u70b9\u89c4\u683c ecs.g6.large \u9009\u62e9\u5bf9\u5e94cpu\u6838\u6570\u548c\u5185\u5b58\u5927\u5c0f\u7684ecs\u5b9e\u4f8b\uff0c\u7528\u4f5ck8s\u8282\u70b9 Kubernetes\u914d\u7f6e Worker \u7cfb\u7edf\u76d8\u78c1\u76d8\u7c7b\u578b ESSD\u4e91\u76d8 \u9009\u62e9k8s\u96c6\u7fa4Worker\u8282\u70b9\u4f7f\u7528\u7684\u7cfb\u7edf\u76d8\u78c1\u76d8\u7c7b\u578b Kubernetes\u914d\u7f6e Worker\u8282\u70b9\u7cfb\u7edf\u76d8\u5927\u5c0f(GB) 120 \u8bbe\u7f6eWorker\u8282\u70b9\u7cfb\u7edf\u76d8\u5927\u5c0f\uff0c\u5355\u4f4d\u4e3aGB Kubernetes\u914d\u7f6e ack\u7f51\u7edc\u63d2\u4ef6 Flannel ack\u96c6\u7fa4\u5bf9\u5e94\u7684\u7f51\u7edc\u63d2\u4ef6\uff0c\u53ef\u4ee5\u9009\u62e9Flannel\u6216\u8005Terway\uff0c\u7f51\u7edc\u63d2\u4ef6\u4e0d\u540c\uff0c\u4e0b\u9762\u8bbe\u7f6e\u7684pod\u7f51\u7edc\u53c2\u6570\u4e0d\u540c Kubernetes\u914d\u7f6e Pod \u7f51\u7edc CIDR 10.0.0.0/16 ack Pod\u7f51\u7edc\u6bb5\uff0c\u7f51\u7edc\u63d2\u4ef6\u4e3aFlannel\u65f6\u5fc5\u586b\uff0c\u8bf7\u586b\u5199\u6709\u6548\u7684\u79c1\u6709\u7f51\u6bb5\uff0c\u5373\u4ee5\u4e0b\u7f51\u6bb5\u53ca\u5176\u5b50\u7f51\uff1a10.0.0.0/8\uff0c172.16-31.0.0/12-16\uff0c192.168.0.0/16\uff0c\u4e0d\u80fd\u4e0e VPC \u53ca VPC \u5185\u5df2\u6709 Kubernetes \u96c6\u7fa4\u4f7f\u7528\u7684\u7f51\u6bb5\u91cd\u590d\u3002 Kubernetes\u914d\u7f6e pod\u4ea4\u6362\u673a\u5b9e\u4f8bID vsw-xx ack Pod\u4ea4\u6362\u673a\u5b9e\u4f8bid\uff0c\u7f51\u7edc\u63d2\u4ef6\u4e3aTerway\u65f6\u5fc5\u586b\uff0c\u5efa\u8bae\u9009\u62e9\u7f51\u6bb5\u63a9\u7801\u4e0d\u5927\u4e8e 19 \u7684\u865a\u62df\u4ea4\u6362\u673a Kubernetes\u914d\u7f6e Service CIDR 172.16.0.0/16 ack Service\u7f51\u7edc\u6bb5, \u53ef\u9009\u8303\u56f4\uff1a10.0.0.0/16-24\uff0c172.16-31.0.0/16-24\uff0c192.168.0.0/16-24,\u4e0d\u80fd\u4e0e VPC \u53ca VPC \u5185\u5df2\u6709 Kubernetes \u96c6\u7fa4\u4f7f\u7528\u7684\u7f51\u6bb5\u91cd\u590d\u3002 \u5e94\u7528\u914d\u7f6e namespace gitlab-runner helm\u5e94\u7528\u5de5\u4f5c\u7684\u547d\u540d\u7a7a\u95f4\u3002 \u5e94\u7528\u914d\u7f6e Helm \u914d\u7f6e {} helm\u7684\u914d\u7f6e\u8be6\u7ec6\u53c2\u8003https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml\uff5c \u90e8\u7f72\u6d41\u7a0b \u8bbf\u95ee\u8ba1\u7b97\u5de2 \u90e8\u7f72\u94fe\u63a5 \uff0c\u6309\u63d0\u793a\u586b\u5199\u90e8\u7f72\u53c2\u6570 \u586b\u5199\u662f\u5426\u65b0\u5efa\u6216\u9009\u62e9\u5df2\u6709\u7684\u96c6\u7fa4 \u586b\u5199Helm\u914d\u7f6e \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u8be5Helm\u5e94\u7528\u8fd0\u884c\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u9ed8\u8ba4\u503c\u4e3a{\"Ref\":\"ALIYUN::StackName\"}\u4ee3\u8868\u4f7f\u7528\u8ba1\u7b97\u5de2\u5b9e\u4f8b\u540d\u79f0\u4f5c\u4e3a\u547d\u540d\u7a7a\u95f4 \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3aChart values\uff0c\u5373Helm\u5e94\u7528\u8fd0\u884c\u662f\u8981\u7684\u53c2\u6570\u3002 \u6ce8\u610f\u6b64\u5904\u5fc5\u987b\u5c06GitlabUrl\u548cGitlabRunnerToken\u8fdb\u884c\u66ff\u6362 \u3002 GitlabUrl\u662f\u60a8\u7684Gitlab\u5bf9\u5916\u66b4\u9732\u7684\u5730\u5740\uff0cGitlabRunnerToken\u4e3aGitlab\u5904\u6ce8\u518c\u7684runner\u7684token\uff0c\u7528\u4e8eGitlab\u548cRunner\u8fdb\u884c\u8ba4\u8bc1\uff0c\u83b7\u53d6Token\u53ef\u53c2\u8003\u4e0b\u4e24\u56fe\u6240\u793a\uff1a \u65b0\u5efaRunner \u6ce8\u518c\u5728Gitlab\u5904\u6210\u529f\u521b\u5efa\u597dRunner\u7684\u793a\u610f\u56fe\u5982\u56fe\u6240\u793a\uff0c\u6ce8\u610f\u5f53\u524d\u754c\u9762\u5173\u95ed\u540e\u5219\u65e0\u6cd5\u518d\u6b21\u67e5\u770bToken\uff1a \u9ed8\u8ba4\u914d\u7f6e\u7684\u503c\u4e2d\uff0cconcurrent\u4e3a\u5e76\u53d1\u4f5c\u4e1a\u6570\u91cf\uff0c\u5982\u5f53\u524d\u5e76\u672a\u90e8\u7f72\u81ea\u5df1\u7684Gitlab\u53ef\u4ee5\u91c7\u7528\u5b98\u65b9\u7684\u5730\u5740\uff0c\u5373\u586b\u5199\uff1ahttps://gitlab.com\u3002 ** \u6ce8\u610f\uff1aGitlab Runner\u7684manager\u8282\u70b9\u548c\u88ab\u8c03\u5ea6\u7684job\u8282\u70b9\u90fd\u5de5\u4f5c\u5728{{.Release.Namespace}}\u4e0b\uff0c\u8bf7\u4e0d\u8981\u5bf9\u6b64\u9879\u914d\u7f6e\u8fdb\u884c\u4fee\u6539\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u6743\u9650\u95ee\u9898\u3002** \u5176\u4ed6\u53c2\u6570\u7684\u8c03\u6574\u53ef\u53c2\u8003 \u5b98\u65b9\u6587\u6863 \u3002 \u70b9\u51fb\u7acb\u5373\u521b\u5efa\uff0c\u7b49\u5f85\u670d\u52a1\u5b9e\u4f8b\u90e8\u7f72\u5b8c\u6210 \u670d\u52a1\u5b9e\u4f8b\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u5b9e\u4f8bID\u8fdb\u5165\u5230\u8be6\u60c5\u754c\u9762\uff0c\u5982\u56fe\u6240\u793a\uff0c\u63d0\u793a\u5df2\u7ecf\u90e8\u7f72\u6210\u529f \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5728\u539fGitlab\u4e2d\u521b\u5efa\u6d41\u6c34\u7ebf\u548c\u6267\u884c\u4e86 \u8fdb\u9636\u914d\u7f6e \u52a8\u6001\u4fee\u6539Helm\u7684Values\u503c(\u4ee5\u4e0b\u9ad8\u9636\u914d\u7f6e\u9700\u4f9d\u8d56\u6b64\u529f\u80fd) \u70b9\u51fb\u8fdb\u5165\u670d\u52a1\u5b9e\u4f8b\u8be6\u60c5\u9875\uff0c\u70b9\u51fb\u53f3\u4e0a\u89d2\u7684\u4fee\u6539\u914d\u7f6e \u9009\u62e9\u4fee\u6539Helm\u914d\u7f6e\u3002 \u4fee\u6539\u90e8\u7f72\u53c2\u6570\uff0c\u5e76\u53d8\u914d\u3002 \u7b49\u5f85\u5b9e\u4f8b\u53d8\u914d\u5373\u5b9e\u73b0\u4e86Helm\u7684\u52a8\u6001\u66f4\u65b0\u3002 \u4e3a\u6d41\u6c34\u7ebf\u914d\u7f6eOSS\u7f13\u5b58\u8fdb\u884c\u52a0\u901f \u8fd9\u91cc\u7684\u7f13\u5b58\u4e3a\u6d41\u6c34\u7ebf\u4f5c\u4e1a\u7f13\u5b58\uff0c\u5982\u7f13\u5b58Python\u4f9d\u8d56\u9879 \u914d\u7f6e\u90e8\u5206 \u65b0\u5efaOSS\u4ed3\u5e93\u3002\u53ef\u53c2\u8003\u6b64 \u6587\u6863 \u521b\u5efaOSS\u3002\u5efa\u8bae\u4e0e\u96c6\u7fa4\u540c\u5730\u57df\u3002 \u521b\u5efa\u4e00\u4e2aOSS\u76f8\u5173\u7684Ram\u7528\u6237\uff0c\u5e76\u4e3a\u8be5\u7528\u6237\u6388\u6743OSS\u76f8\u5173\u6743\u9650\uff0c\u4e14\u4fdd\u5b58\u5176\u8bbf\u95eeAK\u548cSK\u3002\u53ef\u53c2\u8003\u6b64 \u6587\u6863 \u8fdb\u884c\u76f8\u5173Ram ak\u548csk\u7684\u521b\u5efa\u3002 \u70b9\u51fb\u8fdb\u5165\u670d\u52a1\u5b9e\u4f8b\u8be6\u60c5\u9875\uff0c\u70b9\u51fb\u53f3\u4e0a\u89d2\u7684\u4fee\u6539\u914d\u7f6e \u9009\u62e9\u4fee\u6539Helm\u914d\u7f6e\u3002 \u627e\u5230[[runners]]\u8be5\u884c\uff0c\u5728\u5176\u5b50\u5217\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a [runners.cache] type = \"s3\" shared = true [runners.cache.s3] #\u793a\u4f8b\"oss-ap-southeast-1.aliyuncs.com\" ServerAddress = \"${ServerAddress}\" AccessKey = \"LTAxxxxx\" SecretKey = \"0KPDxxxx\" #\u793a\u4f8b\"gitlab-runner\" BucketName = \"${BucketName}\" #\u793a\u4f8b\"ap-southeast-1\" BucketLocation = \"${Region}\" Insecure = false \u7b49\u5f85\u5b9e\u4f8b\u53d8\u914d\u5373\u5b9e\u73b0\u4e86Helm\u7684\u52a8\u6001\u66f4\u65b0\u3002 \u4f7f\u7528\u90e8\u5206 \u5728\u5b8c\u6210\u4e0a\u8ff0\u914d\u7f6e\u540e\uff0c\u5728\u7f16\u5199\u6784\u5efa\u955c\u50cf\u7684\u6d41\u6c34\u7ebf\u53ef\u8bbe\u7f6e\u7f13\u5b58\u7684\u4f4d\u7f6e\u3002\u53ef\u8bbe\u7f6e\u7f13\u5b58\u7684cache key\u548cpaths\u6765\u6307\u5b9a\u7f13\u5b58\u8def\u5f84\u3002 build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ \u6d41\u6c34\u7ebf\u5728\u8fd0\u884c\u65f6\u5982\u6709\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5219\u4ee3\u8868\u6784\u5efa\u4f7f\u7528\u4e86\u7f13\u5b58 \u6d41\u6c34\u7ebf\u7f13\u5b58\u8be6\u7ec6\u6587\u6863\u53ef\u53c2\u8003 \u6587\u6863 \u901a\u8fc7\u914d\u7f6eHPA\u89c4\u5219\u5b9e\u73b0Runner Manager\u8282\u70b9\u52a8\u6001\u4f38\u7f29 \u670d\u52a1\u521b\u5efa\u754c\u9762\u5df2\u9ed8\u8ba4\u51c6\u5907\u4e86\u4e00\u4e2aHPA\u89c4\u5219 hpa: minReplicas: 2 maxReplicas: 10 metrics: - type: Resource resource: name: cpu target: averageUtilization: 10 type: Utilization \u76f8\u5e94\u5730\u89e3\u91ca\u5982\u4e0b\uff1a minReplicas: 2\uff1a\u6700\u5c0f\u526f\u672c\u6570\u4e3a2\u3002\u8fd9\u610f\u5473\u7740\u5373\u4f7f\u8d1f\u8f7d\u5f88\u4f4e\uff0cDeployment \u4e5f\u81f3\u5c11\u4f1a\u4fdd\u6301\u8fd0\u884c 2 \u4e2a\u526f\u672c\u3002 maxReplicas: 10\uff1a\u6700\u5927\u526f\u672c\u6570\u4e3a10\u3002\u8fd9\u662f HPA \u5728\u81ea\u52a8\u6269\u5c55\u65f6\u53ef\u4ee5\u589e\u52a0\u5230\u7684\u6700\u9ad8\u526f\u672c\u6570\u91cf\uff0c\u4ee5\u5e94\u5bf9\u9ad8\u8d1f\u8f7d\u3002 target.averageValue: 10\uff1a\u76ee\u6807\u5e73\u5747\u503c\u4e3a10%\u3002\u8fd9\u610f\u5473\u7740 HPA \u5c06\u5c1d\u8bd5\u4fdd\u6301\u6bcf\u4e2a CPU\u4e0a\u7684 CPU\u6307\u6807\u7684\u5e73\u5747\u503c\u4e3a 2\u3002\u5982\u679c\u6bcf\u4e2a Pod \u7684\u4f5c\u4e1a\u6570\u9ad8\u4e8e 2\uff0cHPA \u5c06\u503e\u5411\u4e8e\u589e\u52a0\u526f\u672c\uff1b\u5982\u679c\u4f4e\u4e8e 2\uff0cHPA \u5c06\u51cf\u5c11\u526f\u672c\uff0c\u4f46\u4e0d\u4f1a\u4f4e\u4e8e minReplicas \u7684\u8bbe\u7f6e\u3002 \u8fd9\u4e9b\u914d\u7f6e\u610f\u5473\u7740\uff0cHPA \u4f1a\u6839\u636eCPU\u5229\u7528\u7387\u6765\u8c03\u6574 Pod \u7684\u6570\u91cf\uff0c\u786e\u4fdd\u5728 2 \u5230 10 \u4e2a\u526f\u672c\u4e4b\u95f4\u52a8\u6001\u8c03\u6574\u4ee5\u6ee1\u8db3\u5904\u7406\u9700\u6c42\u3002 \u66f4\u591aHPA\u6559\u7a0b\u89c1\uff1ahttps://help.aliyun.com/zh/ack/hpa ACK\u573a\u666f\u4e0b\u4f7f\u7528ECI+Spot\u5f39\u6027\u8fd0\u884cWorker\u8282\u7701\u6210\u672c \u9009\u62e9\u5bf9\u5e94\u7684ack\u96c6\u7fa4\uff0c\u8fd0\u7ef4\u7ba1\u7406->\u7ec4\u4ef6\u7ba1\u7406->\u5b89\u88c5ACK Virtual Node \u5f00\u542fECI\u5f39\u6027\u80fd\u529b\u3002\u540e\u7eedrunner\u7684job\u4f1a\u76f4\u63a5\u6267\u884c\u5728\u865a\u62df\u8282\u70b9\u4e0a \u5982\u679c\u9700\u8981\u8ba9runner manager\u8282\u70b9\u4e5f\u8fd0\u884c\u5728spot\u5b9e\u4f8b\u4e0a\uff0c\u53ef\u53c2\u8003\u5982\u4e0b\u914d\u7f6e\u3002 \u901a\u8fc7\u6dfb\u52a0\u5982\u4e0b\u6ce8\u89e3\uff0c\u53ef\u4ee5\u8ba9ACK\u4e2d\u7684pod\u6ce8\u518c\u91c7\u7528\u865a\u62df\u8282\u70b9\u3002\u6ce8\u610f\u8be5\u53c2\u6570\u7684\u5c42\u7ea7\u4e0erunnerRegistrationToken\u76f8\u540c podLabels: alibabacloud.com/eci: \"true\" \u540c\u65f6\u9700\u8981\u5728runners\u7684config\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u914d\u7f6e\uff1a [runners.kubernetes.pod_labels] \"alibabacloud.com/compute-qos\" = \"best-effort\" \"alibabacloud.com/compute-class\" = \"general-purpose\" \"alibabacloud.com/eci\" = \"true\" \u5982\u56fe\u6240\u793a\uff1a \u8865\u5145\uff1a\u5982\u679c\u9009\u62e9\u4e3aACS\u96c6\u7fa4\uff0c\u5219\u8282\u70b9\u9ed8\u8ba4\u90fd\u4f1a\u5728\u865a\u62df\u8282\u70b9\u4e0a\uff0c\u65e0\u9700\u989d\u5916\u914d\u7f6e\u3002 \u5982\u679c\u9700\u8981\u8fdb\u4e00\u6b65\u9650\u5236runner manager\u6d88\u8017\u7684\u8d44\u6e90\uff0c\u53ef\u53c2\u8003\u5982\u4e0b\u8bbe\u7f6e\uff0c\u5c42\u7ea7\u4ecd\u4e3a\u6700\u5916\u5c42\uff1a resources: requests: cpu: \"250m\" memory: \"256Mi\" limits: cpu: \"1000m\" memory: \"512Mi\" \u955c\u50cf\u6784\u5efa\u793a\u4f8b \u5c06Gitlab runner\u6784\u5efa\u7684\u955c\u50cf\u4e0a\u4f20\u5230\u955c\u50cf\u4ed3\u5e93 \u5982\u679c\u6ca1\u6709\u955c\u50cf\u4ed3\u5e93\u7684\u8bdd\uff0c\u53ef\u53c2\u8003\u963f\u91cc\u4e91\u7684acr\u670d\u52a1\u8fdb\u884c\u521b\u5efa\u3002 \u53c2\u8003\u6587\u6863\uff1ahttps://help.aliyun.com/zh/acr/user-guide/create-a-container-registry-enterprise-edition-instance?spm=a2c4g.11186623.help-menu-60716.d_2_0_0.7f991ecdmE3Nmr \u4f7f\u7528Gitlab runner\u7684\u4e00\u4e2a\u5e38\u7528\u573a\u666f\u4e3aDocker\u955c\u50cf\u7684\u6784\u5efa\u3002\u76ee\u524d\u901a\u7528\u7684\u65b9\u6848\u6709\u4e24\u79cd 1. Docker in Docker\u3002 2. kaniko \u7531\u4e8e\u4f7f\u7528kaniko\u53ef\u51cf\u5c11\u865a\u62df\u5316\u7684\u635f\u8017\uff0c\u6548\u7387\u66f4\u597d\uff0c\u56e0\u6b64\u6b64\u5904\u4ec5\u7ed9\u51fa\u7b2c\u4e8c\u79cd\u65b9\u6848\u7684\u793a\u4f8b\u3002 3. \u6ce8\u610f\u9700\u8981\u6307\u5b9a\u8fd0\u884c\u7684\u955c\u50cf\u4e3a\uff1aregistry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ image: name: registry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug entrypoint: [\"\"] script: - echo \"{\\\"auths\\\":{\\\"${ACR_REGISTRY}\\\":{\\\"auth\\\":\\\"$(printf \"%s:%s\" \"${CI_REGISTRY_USER}\" \"${CI_REGISTRY_PASSWORD}\" | base64 | tr -d '\\n')\\\"}}}\" > /kaniko/.docker/config.json - /kaniko/executor --context \"$CI_PROJECT_DIR\" --dockerfile \"$CI_PROJECT_DIR/Dockerfile\" --destination ${ACR_REGISTRY}:latest \u8bf4\u660e\uff1a CI_REGISTRY_USER\uff0cCI_REGISTRY_PASSWORD\uff0cACR_REGISTRY\u53c2\u6570\u4e3aSecret\u6216\u8005\u73af\u5883\u53d8\u91cf\u3002\u53ef\u5728\u6b64\u5904\u6dfb\u52a0\uff1a $CI_PROJECT_DIR\u4ee3\u8868\u5f53\u524d\u9879\u76ee\u8def\u5f84\u3002 \u5176\u4e2d\u53c2\u6570--context\u4ee3\u8868\u6784\u5efa\u7684\u76ee\u5f55 --destination\u4ee3\u8868\u955c\u50cf\u4ed3\u5e93\u5730\u5740\u3002 \u66f4\u591akaniko\u53c2\u6570\u53ef\u53c2\u8003\uff1ahttps://github.com/GoogleContainerTools/kaniko \u955c\u50cf\u6784\u5efa\u7f13\u5b58\u914d\u7f6e \u6ce8\u610f \uff1a\u6b64\u5904\u7684\u7f13\u5b58\u6307\u4f7f\u7528kaniko\u6784\u5efa\u955c\u50cf\u65f6\u5f00\u542f\u955c\u50cf\u4e0d\u540c\u5c42\u4e4b\u95f4\u7684\u7f13\u5b58\u3002 \u5982\u679c\u91c7\u7528\u4e86\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u53ef\u53c2\u8003\u4e0b\u5217\u8bbe\u7f6e\u76f4\u63a5\u5f00\u542f\u955c\u50cf\u6784\u5efa\u65f6\u7684\u52a0\u901f\u3002 caching Layers \uff1akaniko \u53ef\u4ee5\u5728\u8fdc\u7a0b\u5b58\u50a8\u5e93\u4e2d\u7f13\u5b58\u7531RUN\uff08\u7531flag\u2013cache-RUN-layers\u914d\u7f6e\uff09\u548cCOPY\uff08\u7531flag\u2013cache-COPY-layeers\u914d\u7f6e\uff09\u547d\u4ee4\u521b\u5efa\u7684\u5c42\u3002 \u5728\u6267\u884c\u547d\u4ee4\u4e4b\u524d kaniko \u4f1a\u68c0\u67e5\u5f53\u524d\u5c42\u7684\u7f13\u5b58\u5e76\u5229\u7528 \u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e --cache=true \u6807\u5fd7\u9009\u62e9\u7f13\u5b58,\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7--cache-repo \u6807\u5fd7\u63d0\u4f9b\u7528\u4e8e\u5b58\u50a8\u7f13\u5b58\u5c42\u7684\u8fdc\u7a0b\u5b58\u50a8\u5e93, \u5982\u679c\u672a\u63d0\u4f9b\u6b64\u6807\u5fd7\u5219\u5c06\u4ece\u63d0\u4f9b\u7684--destination\u63a8\u65ad\u7f13\u5b58\u7684repo\u3002 \u4e00\u4e2a\u4f7f\u7528\u4e86kaniko\u7f13\u5b58\u7684\u793a\u4f8b\u53ef\u53c2\u8003\uff1a script: - echo \"{\\\"auths\\\":{\\\"${ACR_REGISTRY}\\\":{\\\"auth\\\":\\\"$(printf \"%s:%s\" \"${CI_REGISTRY_USER}\" \"${CI_REGISTRY_PASSWORD}\" | base64 | tr -d '\\n')\\\"}}}\" > /kaniko/.docker/config.json - /kaniko/executor --context \"$CI_PROJECT_DIR\" --dockerfile \"$CI_PROJECT_DIR/Dockerfile\" --destination ${ACR_REGISTRY}:latest --cache=true \u8fd9\u91cc\u6700\u540e\u7ed9\u51fa\u4e00\u4e2a\u5b8c\u6574\u53ef\u4ee5\u4f7f\u7528\u7684runner\u914d\u7f6e\uff1a stages: # List of stages for jobs, and their order of execution - build - test - deploy variables: KUBERNETES_POD_LABELS_1: \"alibabacloud.com/compute-class=general-purpose\" KUBERNETES_POD_LABELS_2: \"alibabacloud.com/compute-qos=best-effort\" build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ image: name: registry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug entrypoint: [\"\"] script: - echo \"{\\\"auths\\\":{\\\"${ACR_REGISTRY}\\\":{\\\"auth\\\":\\\"$(printf \"%s:%s\" \"${CI_REGISTRY_USER}\" \"${CI_REGISTRY_PASSWORD}\" | base64 | tr -d '\\n')\\\"}}}\" > /kaniko/.docker/config.json - /kaniko/executor --context \"$CI_PROJECT_DIR\" --dockerfile \"$CI_PROJECT_DIR/Dockerfile\" --destination ${ACR_REGISTRY}:latest --cache=true \u5b8c\u6574Values\u53c2\u8003 https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml \u53ef\u57fa\u4e8e\u6b64\u5b9e\u73b0\u4e00\u4e9b\u66f4\u9ad8\u9636\u7684\u914d\u7f6e\uff0c\u6bd4\u5982\u901a\u8fc7Hpa\u5b9e\u73b0Runner manager\u8282\u70b9\u7684\u52a8\u6001\u6269\u7f29\u5bb9\u3002 Gitlab Runner\u7684\u5b98\u65b9\u914d\u7f6e\u6587\u6863\u53c2\u8003\uff1ahttps://gitlab.cn/docs/runner/configuration/","title":"Gitlab Runner"},{"location":"#gitlab-runner","text":"\u514d\u8d23\u58f0\u660e\uff1a \u672c\u670d\u52a1\u7531\u7b2c\u4e09\u65b9\u63d0\u4f9b\uff0c\u6211\u4eec\u5c3d\u529b\u786e\u4fdd\u5176\u5b89\u5168\u6027\u3001\u51c6\u786e\u6027\u548c\u53ef\u9760\u6027\uff0c\u4f46\u65e0\u6cd5\u4fdd\u8bc1\u5176\u5b8c\u5168\u514d\u4e8e\u6545\u969c\u3001\u4e2d\u65ad\u3001\u9519\u8bef\u6216\u653b\u51fb\u3002\u56e0\u6b64\uff0c\u672c\u516c\u53f8\u5728\u6b64\u58f0\u660e\uff1a\u5bf9\u4e8e\u672c\u670d\u52a1\u7684\u5185\u5bb9\u3001\u51c6\u786e\u6027\u3001\u5b8c\u6574\u6027\u3001\u53ef\u9760\u6027\u3001\u9002\u7528\u6027\u4ee5\u53ca\u53ca\u65f6\u6027\u4e0d\u4f5c\u4efb\u4f55\u9648\u8ff0\u3001\u4fdd\u8bc1\u6216\u627f\u8bfa\uff0c\u4e0d\u5bf9\u60a8\u4f7f\u7528\u672c\u670d\u52a1\u6240\u4ea7\u751f\u7684\u4efb\u4f55\u76f4\u63a5\u6216\u95f4\u63a5\u7684\u635f\u5931\u6216\u635f\u5bb3\u627f\u62c5\u4efb\u4f55\u8d23\u4efb\uff1b\u5bf9\u4e8e\u60a8\u901a\u8fc7\u672c\u670d\u52a1\u8bbf\u95ee\u7684\u7b2c\u4e09\u65b9\u7f51\u7ad9\u3001\u5e94\u7528\u7a0b\u5e8f\u3001\u4ea7\u54c1\u548c\u670d\u52a1\uff0c\u4e0d\u5bf9\u5176\u5185\u5bb9\u3001\u51c6\u786e\u6027\u3001\u5b8c\u6574\u6027\u3001\u53ef\u9760\u6027\u3001\u9002\u7528\u6027\u4ee5\u53ca\u53ca\u65f6\u6027\u627f\u62c5\u4efb\u4f55\u8d23\u4efb\uff0c\u60a8\u5e94\u81ea\u884c\u627f\u62c5\u4f7f\u7528\u540e\u679c\u4ea7\u751f\u7684\u98ce\u9669\u548c\u8d23\u4efb\uff1b\u5bf9\u4e8e\u56e0\u60a8\u4f7f\u7528\u672c\u670d\u52a1\u800c\u4ea7\u751f\u7684\u4efb\u4f55\u635f\u5931\u3001\u635f\u5bb3\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u76f4\u63a5\u635f\u5931\u3001\u95f4\u63a5\u635f\u5931\u3001\u5229\u6da6\u635f\u5931\u3001\u5546\u8a89\u635f\u5931\u3001\u6570\u636e\u635f\u5931\u6216\u5176\u4ed6\u7ecf\u6d4e\u635f\u5931\uff0c\u4e0d\u627f\u62c5\u4efb\u4f55\u8d23\u4efb\uff0c\u5373\u4f7f\u672c\u516c\u53f8\u4e8b\u5148\u5df2\u88ab\u544a\u77e5\u53ef\u80fd\u5b58\u5728\u6b64\u7c7b\u635f\u5931\u6216\u635f\u5bb3\u7684\u53ef\u80fd\u6027\uff1b\u6211\u4eec\u4fdd\u7559\u4e0d\u65f6\u4fee\u6539\u672c\u58f0\u660e\u7684\u6743\u5229\uff0c\u56e0\u6b64\u8bf7\u60a8\u5728\u4f7f\u7528\u672c\u670d\u52a1\u524d\u5b9a\u671f\u68c0\u67e5\u672c\u58f0\u660e\u3002\u5982\u679c\u60a8\u5bf9\u672c\u58f0\u660e\u6216\u672c\u670d\u52a1\u5b58\u5728\u4efb\u4f55\u95ee\u9898\u6216\u7591\u95ee\uff0c\u8bf7\u8054\u7cfb\u6211\u4eec\u3002","title":"Gitlab Runner"},{"location":"#_1","text":"\u6781\u72d0GitLab Runner \u8fd0\u884c\u5b9a\u4e49\u5728\u6781\u72d0GitLab \u4e2d\u7684 CI/CD \u4f5c\u4e1a\u3002\u6781\u72d0GitLab Runner \u53ef\u4ee5\u4ee5\u5355\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u8fd0\u884c\uff0c\u4e14\u6ca1\u6709\u7279\u5b9a\u4e8e\u8bed\u8a00\u7684\u8981\u6c42\u3002 \u6781\u72d0GitLab Runner \u7684\u7279\u6027\u5982\u4e0b\u3002 \u5e76\u884c\u8fd0\u884c\u591a\u4e2a\u4f5c\u4e1a\u3002 \u5728\u591a\u4e2a\u670d\u52a1\u5668\u4e0a\u4f7f\u7528\u591a\u4e2a\u4ee4\u724c\uff08\u751a\u81f3\u6bcf\u4e2a\u9879\u76ee\uff09\u3002 \u9650\u5236\u6bcf\u4e2a\u4ee4\u724c\u7684\u5e76\u53d1\u4f5c\u4e1a\u6570\u3002 \u4f5c\u4e1a\u53ef\u4ee5\u5728\u4ee5\u4e0b\u73af\u5883\u8fd0\u884c\u4f5c\u4e1a\uff1a \u672c\u5730\u3002 \u4f7f\u7528 Docker \u5bb9\u5668\u3002 \u4f7f\u7528 Docker \u5bb9\u5668\u5e76\u901a\u8fc7 SSH \u6267\u884c\u4f5c\u4e1a\u3002 \u5728\u4e0d\u540c\u7684\u4e91\u548c\u865a\u62df\u5316\u5e73\u53f0\u4e0a\u4f7f\u7528\u5f39\u6027\u4f38\u7f29\u7684 Docker \u5bb9\u5668\u3002 \u8fde\u63a5\u5230\u8fdc\u7a0b SSH \u670d\u52a1\u5668\u3002 \u4f7f\u7528 Go \u8bed\u8a00\u7f16\u5199\u5e76\u4f5c\u4e3a\u5355\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u5206\u53d1\uff0c\u6ca1\u6709\u4efb\u4f55\u5176\u5b83\u9700\u6c42\u3002 \u652f\u6301 Bash\u3001PowerShell Core \u548c Windows PowerShell\u3002 \u9002\u7528\u4e8e GNU/Linux\u3001macOS \u548c Windows\uff08\u53ef\u4ee5\u8fd0\u884c Docker \u7684\u51e0\u4e4e\u4efb\u4f55\u73af\u5883\uff09\u3002 \u5141\u8bb8\u81ea\u5b9a\u4e49\u4f5c\u4e1a\u8fd0\u884c\u73af\u5883\u3002 \u65e0\u9700\u91cd\u542f\u5373\u53ef\u81ea\u52a8\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u3002 \u6613\u4e8e\u4f7f\u7528\u7684\u8bbe\u7f6e\uff0c\u652f\u6301 Docker\u3001Docker-SSH\u3001Parallels \u6216 SSH \u8fd0\u884c\u73af\u5883\u3002 \u542f\u7528\u7f13\u5b58 Docker \u5bb9\u5668\u3002 \u8f7b\u677e\u5b89\u88c5\u4e3a GNU/Linux\u3001macOS \u548c Windows \u7684\u670d\u52a1\u3002 \u5d4c\u5165\u5f0f Prometheus \u6307\u6807 HTTP \u670d\u52a1\u5668\u3002 \u652f\u6301\u88ab\u76d1\u63a7\uff0c\u5e76\u5c06 Prometheus \u6307\u6807\u548c\u5176\u4ed6\u7279\u5b9a\u4f5c\u4e1a\u7684\u6570\u636e\u4f20\u9012\u7ed9\u6781\u72d0GitLab\u3002 \u672c\u670d\u52a1\u53ef\u57fa\u4e8e\u963f\u91cc\u4e91\u5bb9\u5668\u865a\u62df\u8282\u70b9\u7684\u529f\u80fd\u6781\u5feb\u901f\u5730\u7533\u8bf7runner pod\uff0c\u4e14\u6781\u5927\u51cf\u5c11\u6210\u672c\u3002\u9ed8\u8ba4\u7533\u8bf7\u7684\u865a\u62df\u8282\u70b9\u7c7b\u578b\u4e3a\uff1a \"alibabacloud.com/compute-qos\" = \"best-effort\" \"alibabacloud.com/compute-class\" = \"general-purpose\" \u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u6781\u72d0GitLab Runner \u7684\u7cfb\u7edf\u9700\u6c42\u914d\u7f6e\u53d6\u51b3\u4e8e\uff1a CI/CD \u4f5c\u4e1a\u6240\u9700\u7684 CPU \u8d1f\u8f7d\u3002 CI/CD \u4f5c\u4e1a\u6240\u9700\u7684\u5185\u5b58\u4f7f\u7528\u91cf\u3002 CI/CD \u4f5c\u4e1a\u7684\u5e76\u53d1\u6570\u91cf\u3002 \u5f00\u53d1\u4e2d\u7684\u9879\u76ee\u6570\u91cf\u3002 \u9884\u671f\u540c\u65f6\u5de5\u4f5c\u7684\u5f00\u53d1\u4eba\u5458\u6570\u91cf\u3002","title":"\u6982\u8ff0"},{"location":"#_2","text":"\u90e8\u7f72Gitlab Runner\u793e\u533a\u7248\u670d\u52a1\u5b9e\u4f8b\uff0c\u9700\u8981\u5bf9\u90e8\u5206\u963f\u91cc\u4e91\u8d44\u6e90\u8fdb\u884c\u8bbf\u95ee\u548c\u521b\u5efa\u64cd\u4f5c\u3002\u56e0\u6b64\u60a8\u7684\u8d26\u53f7\u9700\u8981\u5305\u542b\u5982\u4e0b\u8d44\u6e90\u7684\u6743\u9650\u3002 \u8bf4\u660e \uff1a\u5f53\u60a8\u7684\u8d26\u53f7\u662fRAM\u8d26\u53f7\u65f6\uff0c\u624d\u9700\u8981\u6dfb\u52a0\u6b64\u6743\u9650\u3002 \u6743\u9650\u7b56\u7565\u540d\u79f0 \u5907\u6ce8 AliyunECSFullAccess \u7ba1\u7406\u4e91\u670d\u52a1\u5668\u670d\u52a1\uff08ECS\uff09\u7684\u6743\u9650 AliyunVPCFullAccess \u7ba1\u7406\u4e13\u6709\u7f51\u7edc\uff08VPC\uff09\u7684\u6743\u9650 AliyunROSFullAccess \u7ba1\u7406\u8d44\u6e90\u7f16\u6392\u670d\u52a1\uff08ROS\uff09\u7684\u6743\u9650 AliyunComputeNestUserFullAccess \u7ba1\u7406\u8ba1\u7b97\u5de2\u670d\u52a1\uff08ComputeNest\uff09\u7684\u7528\u6237\u4fa7\u6743\u9650 AliyunComputeOSSFullAccess \u7ba1\u7406Oss\u7684\u6743\u9650\u6743\u9650 AliyunCSFullAccess \u7ba1\u7406\u5bb9\u5668\u670d\u52a1(CS)\u7684\u6743\u9650","title":"\u524d\u63d0\u6761\u4ef6"},{"location":"#_3","text":"\u793e\u533a\u7248\u5728\u8ba1\u7b97\u5de2\u90e8\u7f72\u7684\u8d39\u7528\u4e3b\u8981\u6d89\u53ca\uff1a \u6240\u9009vCPU\u4e0e\u5185\u5b58\u89c4\u683c \u7cfb\u7edf\u76d8\u7c7b\u578b\u53ca\u5bb9\u91cf \u516c\u7f51\u5e26\u5bbd","title":"\u8ba1\u8d39\u8bf4\u660e"},{"location":"#_4","text":"","title":"\u90e8\u7f72\u67b6\u6784"},{"location":"#_5","text":"\u60a8\u5728\u521b\u5efa\u670d\u52a1\u5b9e\u4f8b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u914d\u7f6e\u670d\u52a1\u5b9e\u4f8b\u4fe1\u606f\u3002\u4e0b\u6587\u4ecb\u7ecdJupyterhub\u670d\u52a1\u5b9e\u4f8b\u8f93\u5165\u53c2\u6570\u7684\u8be6\u7ec6\u4fe1\u606f,\u5206\u4e3a\u5df2\u6709ack\u96c6\u7fa4\u548c\u65b0\u5efaack\u96c6\u7fa4\u4e24\u79cd\u3002","title":"\u90e8\u7f72\u53c2\u6570\u8bf4\u660e"},{"location":"#ack","text":"\u662f\u5426\u65b0\u5efaack\u96c6\u7fa4\u53c2\u6570\u9009\u62e9\u5426\u65f6\uff0c\u4ee3\u8868\u73b0\u5728\u5df2\u6709ack\u96c6\u7fa4\uff0c\u6b64\u65f6\u9700\u8981\u586b\u5199\u4ee5\u4e0b\u53c2\u6570\u3002 \u53c2\u6570\u7ec4 \u53c2\u6570\u9879 \u793a\u4f8b \u8bf4\u660e \u670d\u52a1\u5b9e\u4f8b\u540d\u79f0 test \u5b9e\u4f8b\u7684\u540d\u79f0 \u5730\u57df \u534e\u4e1c1\uff08\u676d\u5dde\uff09 \u9009\u4e2d\u670d\u52a1\u5b9e\u4f8b\u7684\u5730\u57df\uff0c\u5efa\u8bae\u5c31\u8fd1\u9009\u4e2d\uff0c\u4ee5\u83b7\u53d6\u66f4\u597d\u7684\u7f51\u7edc\u5ef6\u65f6\u3002 \u662f\u5426\u65b0\u5efaack\u96c6\u7fa4 \u662f\u5426\u65b0\u5efaack\u96c6\u7fa4 \u5426 \u9009\u62e9\u5426\u4ee3\u8868\u5df2\u6709ack\u96c6\u7fa4\uff0c\u4e0d\u7528\u65b0\u5efa \u662f\u5426\u65b0\u5efaack\u96c6\u7fa4 K8s\u96c6\u7fa4ID ccde6deb0f612402786e611a7e1230d \u6839\u636e\u5730\u57df\u9009\u62e9\u5730\u57df\u4e2d\u7528\u6237\u5df2\u6709\u7684\u96c6\u7fa4id \u5e94\u7528\u914d\u7f6e namespace gitlab-runner helm\u5e94\u7528\u5de5\u4f5c\u7684\u547d\u540d\u7a7a\u95f4\u3002 \u5e94\u7528\u914d\u7f6e Helm \u914d\u7f6e {} helm\u7684\u914d\u7f6e\u8be6\u7ec6\u53c2\u8003https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml\uff5c","title":"\u5df2\u6709ack\u96c6\u7fa4"},{"location":"#ack_1","text":"\u53c2\u6570\u7ec4 \u53c2\u6570\u9879 \u793a\u4f8b \u8bf4\u660e \u670d\u52a1\u5b9e\u4f8b\u540d\u79f0 test \u5b9e\u4f8b\u7684\u540d\u79f0 \u5730\u57df \u534e\u4e1c1\uff08\u676d\u5dde\uff09 \u9009\u4e2d\u670d\u52a1\u5b9e\u4f8b\u7684\u5730\u57df\uff0c\u5efa\u8bae\u5c31\u8fd1\u9009\u4e2d\uff0c\u4ee5\u83b7\u53d6\u66f4\u597d\u7684\u7f51\u7edc\u5ef6\u65f6\u3002 \u662f\u5426\u65b0\u5efaack\u96c6\u7fa4 \u662f \u9009\u62e9\u662f\u4ee3\u8868\u65b0\u5efaack\u96c6\u7fa4 \u4ed8\u8d39\u7c7b\u578b\u914d\u7f6e \u4ed8\u8d39\u7c7b\u578b \u6309\u91cf\u4ed8\u8d39 \u6216 \u5305\u5e74\u5305\u6708 \u57fa\u7840\u914d\u7f6e \u53ef\u7528\u533a \u53ef\u7528\u533aI \u5730\u57df\u4e0b\u7684\u4e0d\u540c\u53ef\u7528\u533a\u57df \u57fa\u7840\u914d\u7f6e \u4e13\u6709\u7f51\u7edcVPC\u5b9e\u4f8bID vpc-xxx \u9009\u62e9\u5730\u57df\u4e0b\u53ef\u7528\u7684vpc,\u4e0d\u5b58\u5728\u53ef\u4ee5\u65b0\u5efa \u57fa\u7840\u914d\u7f6e \u4ea4\u6362\u673a\u5b9e\u4f8bID vsw-xxx \u9009\u62e9vpc\u4e0b\u7684vsw\uff0c\u8fd9\u4e2avsw\u7b5b\u9009\u4f1a\u53d7\u4e0a\u9762\u4e0d\u540c\u53ef\u7528\u533a\u57df\u5f71\u54cd\uff0c\u4e0d\u5b58\u5728\u53ef\u4ee5\u65b0\u5efa \u57fa\u7840\u914d\u7f6e \u5b9e\u4f8b\u5bc6\u7801 * * \u8bbe\u7f6e\u5b9e\u4f8b\u5bc6\u7801\u3002\u957f\u5ea68~30\u4e2a\u5b57\u7b26\uff0c\u5fc5\u987b\u5305\u542b\u4e09\u9879\uff08\u5927\u5199\u5b57\u6bcd\u3001\u5c0f\u5199\u5b57\u6bcd\u3001\u6570\u5b57\u3001()~!@#$%^&*-+={}[]:;'<>,.?/ \u4e2d\u7684\u7279\u6b8a\u7b26\u53f7\uff09 Kubernetes\u914d\u7f6e Worker\u8282\u70b9\u89c4\u683c ecs.g6.large \u9009\u62e9\u5bf9\u5e94cpu\u6838\u6570\u548c\u5185\u5b58\u5927\u5c0f\u7684ecs\u5b9e\u4f8b\uff0c\u7528\u4f5ck8s\u8282\u70b9 Kubernetes\u914d\u7f6e Worker \u7cfb\u7edf\u76d8\u78c1\u76d8\u7c7b\u578b ESSD\u4e91\u76d8 \u9009\u62e9k8s\u96c6\u7fa4Worker\u8282\u70b9\u4f7f\u7528\u7684\u7cfb\u7edf\u76d8\u78c1\u76d8\u7c7b\u578b Kubernetes\u914d\u7f6e Worker\u8282\u70b9\u7cfb\u7edf\u76d8\u5927\u5c0f(GB) 120 \u8bbe\u7f6eWorker\u8282\u70b9\u7cfb\u7edf\u76d8\u5927\u5c0f\uff0c\u5355\u4f4d\u4e3aGB Kubernetes\u914d\u7f6e ack\u7f51\u7edc\u63d2\u4ef6 Flannel ack\u96c6\u7fa4\u5bf9\u5e94\u7684\u7f51\u7edc\u63d2\u4ef6\uff0c\u53ef\u4ee5\u9009\u62e9Flannel\u6216\u8005Terway\uff0c\u7f51\u7edc\u63d2\u4ef6\u4e0d\u540c\uff0c\u4e0b\u9762\u8bbe\u7f6e\u7684pod\u7f51\u7edc\u53c2\u6570\u4e0d\u540c Kubernetes\u914d\u7f6e Pod \u7f51\u7edc CIDR 10.0.0.0/16 ack Pod\u7f51\u7edc\u6bb5\uff0c\u7f51\u7edc\u63d2\u4ef6\u4e3aFlannel\u65f6\u5fc5\u586b\uff0c\u8bf7\u586b\u5199\u6709\u6548\u7684\u79c1\u6709\u7f51\u6bb5\uff0c\u5373\u4ee5\u4e0b\u7f51\u6bb5\u53ca\u5176\u5b50\u7f51\uff1a10.0.0.0/8\uff0c172.16-31.0.0/12-16\uff0c192.168.0.0/16\uff0c\u4e0d\u80fd\u4e0e VPC \u53ca VPC \u5185\u5df2\u6709 Kubernetes \u96c6\u7fa4\u4f7f\u7528\u7684\u7f51\u6bb5\u91cd\u590d\u3002 Kubernetes\u914d\u7f6e pod\u4ea4\u6362\u673a\u5b9e\u4f8bID vsw-xx ack Pod\u4ea4\u6362\u673a\u5b9e\u4f8bid\uff0c\u7f51\u7edc\u63d2\u4ef6\u4e3aTerway\u65f6\u5fc5\u586b\uff0c\u5efa\u8bae\u9009\u62e9\u7f51\u6bb5\u63a9\u7801\u4e0d\u5927\u4e8e 19 \u7684\u865a\u62df\u4ea4\u6362\u673a Kubernetes\u914d\u7f6e Service CIDR 172.16.0.0/16 ack Service\u7f51\u7edc\u6bb5, \u53ef\u9009\u8303\u56f4\uff1a10.0.0.0/16-24\uff0c172.16-31.0.0/16-24\uff0c192.168.0.0/16-24,\u4e0d\u80fd\u4e0e VPC \u53ca VPC \u5185\u5df2\u6709 Kubernetes \u96c6\u7fa4\u4f7f\u7528\u7684\u7f51\u6bb5\u91cd\u590d\u3002 \u5e94\u7528\u914d\u7f6e namespace gitlab-runner helm\u5e94\u7528\u5de5\u4f5c\u7684\u547d\u540d\u7a7a\u95f4\u3002 \u5e94\u7528\u914d\u7f6e Helm \u914d\u7f6e {} helm\u7684\u914d\u7f6e\u8be6\u7ec6\u53c2\u8003https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml\uff5c","title":"\u65b0\u5efaack\u96c6\u7fa4"},{"location":"#_6","text":"\u8bbf\u95ee\u8ba1\u7b97\u5de2 \u90e8\u7f72\u94fe\u63a5 \uff0c\u6309\u63d0\u793a\u586b\u5199\u90e8\u7f72\u53c2\u6570 \u586b\u5199\u662f\u5426\u65b0\u5efa\u6216\u9009\u62e9\u5df2\u6709\u7684\u96c6\u7fa4 \u586b\u5199Helm\u914d\u7f6e \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u8be5Helm\u5e94\u7528\u8fd0\u884c\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u9ed8\u8ba4\u503c\u4e3a{\"Ref\":\"ALIYUN::StackName\"}\u4ee3\u8868\u4f7f\u7528\u8ba1\u7b97\u5de2\u5b9e\u4f8b\u540d\u79f0\u4f5c\u4e3a\u547d\u540d\u7a7a\u95f4 \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3aChart values\uff0c\u5373Helm\u5e94\u7528\u8fd0\u884c\u662f\u8981\u7684\u53c2\u6570\u3002 \u6ce8\u610f\u6b64\u5904\u5fc5\u987b\u5c06GitlabUrl\u548cGitlabRunnerToken\u8fdb\u884c\u66ff\u6362 \u3002 GitlabUrl\u662f\u60a8\u7684Gitlab\u5bf9\u5916\u66b4\u9732\u7684\u5730\u5740\uff0cGitlabRunnerToken\u4e3aGitlab\u5904\u6ce8\u518c\u7684runner\u7684token\uff0c\u7528\u4e8eGitlab\u548cRunner\u8fdb\u884c\u8ba4\u8bc1\uff0c\u83b7\u53d6Token\u53ef\u53c2\u8003\u4e0b\u4e24\u56fe\u6240\u793a\uff1a \u65b0\u5efaRunner \u6ce8\u518c\u5728Gitlab\u5904\u6210\u529f\u521b\u5efa\u597dRunner\u7684\u793a\u610f\u56fe\u5982\u56fe\u6240\u793a\uff0c\u6ce8\u610f\u5f53\u524d\u754c\u9762\u5173\u95ed\u540e\u5219\u65e0\u6cd5\u518d\u6b21\u67e5\u770bToken\uff1a \u9ed8\u8ba4\u914d\u7f6e\u7684\u503c\u4e2d\uff0cconcurrent\u4e3a\u5e76\u53d1\u4f5c\u4e1a\u6570\u91cf\uff0c\u5982\u5f53\u524d\u5e76\u672a\u90e8\u7f72\u81ea\u5df1\u7684Gitlab\u53ef\u4ee5\u91c7\u7528\u5b98\u65b9\u7684\u5730\u5740\uff0c\u5373\u586b\u5199\uff1ahttps://gitlab.com\u3002 ** \u6ce8\u610f\uff1aGitlab Runner\u7684manager\u8282\u70b9\u548c\u88ab\u8c03\u5ea6\u7684job\u8282\u70b9\u90fd\u5de5\u4f5c\u5728{{.Release.Namespace}}\u4e0b\uff0c\u8bf7\u4e0d\u8981\u5bf9\u6b64\u9879\u914d\u7f6e\u8fdb\u884c\u4fee\u6539\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u6743\u9650\u95ee\u9898\u3002** \u5176\u4ed6\u53c2\u6570\u7684\u8c03\u6574\u53ef\u53c2\u8003 \u5b98\u65b9\u6587\u6863 \u3002 \u70b9\u51fb\u7acb\u5373\u521b\u5efa\uff0c\u7b49\u5f85\u670d\u52a1\u5b9e\u4f8b\u90e8\u7f72\u5b8c\u6210 \u670d\u52a1\u5b9e\u4f8b\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u70b9\u51fb\u5b9e\u4f8bID\u8fdb\u5165\u5230\u8be6\u60c5\u754c\u9762\uff0c\u5982\u56fe\u6240\u793a\uff0c\u63d0\u793a\u5df2\u7ecf\u90e8\u7f72\u6210\u529f \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5728\u539fGitlab\u4e2d\u521b\u5efa\u6d41\u6c34\u7ebf\u548c\u6267\u884c\u4e86","title":"\u90e8\u7f72\u6d41\u7a0b"},{"location":"#_7","text":"","title":"\u8fdb\u9636\u914d\u7f6e"},{"location":"#helmvalues","text":"\u70b9\u51fb\u8fdb\u5165\u670d\u52a1\u5b9e\u4f8b\u8be6\u60c5\u9875\uff0c\u70b9\u51fb\u53f3\u4e0a\u89d2\u7684\u4fee\u6539\u914d\u7f6e \u9009\u62e9\u4fee\u6539Helm\u914d\u7f6e\u3002 \u4fee\u6539\u90e8\u7f72\u53c2\u6570\uff0c\u5e76\u53d8\u914d\u3002 \u7b49\u5f85\u5b9e\u4f8b\u53d8\u914d\u5373\u5b9e\u73b0\u4e86Helm\u7684\u52a8\u6001\u66f4\u65b0\u3002","title":"\u52a8\u6001\u4fee\u6539Helm\u7684Values\u503c(\u4ee5\u4e0b\u9ad8\u9636\u914d\u7f6e\u9700\u4f9d\u8d56\u6b64\u529f\u80fd)"},{"location":"#oss","text":"\u8fd9\u91cc\u7684\u7f13\u5b58\u4e3a\u6d41\u6c34\u7ebf\u4f5c\u4e1a\u7f13\u5b58\uff0c\u5982\u7f13\u5b58Python\u4f9d\u8d56\u9879","title":"\u4e3a\u6d41\u6c34\u7ebf\u914d\u7f6eOSS\u7f13\u5b58\u8fdb\u884c\u52a0\u901f"},{"location":"#_8","text":"\u65b0\u5efaOSS\u4ed3\u5e93\u3002\u53ef\u53c2\u8003\u6b64 \u6587\u6863 \u521b\u5efaOSS\u3002\u5efa\u8bae\u4e0e\u96c6\u7fa4\u540c\u5730\u57df\u3002 \u521b\u5efa\u4e00\u4e2aOSS\u76f8\u5173\u7684Ram\u7528\u6237\uff0c\u5e76\u4e3a\u8be5\u7528\u6237\u6388\u6743OSS\u76f8\u5173\u6743\u9650\uff0c\u4e14\u4fdd\u5b58\u5176\u8bbf\u95eeAK\u548cSK\u3002\u53ef\u53c2\u8003\u6b64 \u6587\u6863 \u8fdb\u884c\u76f8\u5173Ram ak\u548csk\u7684\u521b\u5efa\u3002 \u70b9\u51fb\u8fdb\u5165\u670d\u52a1\u5b9e\u4f8b\u8be6\u60c5\u9875\uff0c\u70b9\u51fb\u53f3\u4e0a\u89d2\u7684\u4fee\u6539\u914d\u7f6e \u9009\u62e9\u4fee\u6539Helm\u914d\u7f6e\u3002 \u627e\u5230[[runners]]\u8be5\u884c\uff0c\u5728\u5176\u5b50\u5217\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a [runners.cache] type = \"s3\" shared = true [runners.cache.s3] #\u793a\u4f8b\"oss-ap-southeast-1.aliyuncs.com\" ServerAddress = \"${ServerAddress}\" AccessKey = \"LTAxxxxx\" SecretKey = \"0KPDxxxx\" #\u793a\u4f8b\"gitlab-runner\" BucketName = \"${BucketName}\" #\u793a\u4f8b\"ap-southeast-1\" BucketLocation = \"${Region}\" Insecure = false \u7b49\u5f85\u5b9e\u4f8b\u53d8\u914d\u5373\u5b9e\u73b0\u4e86Helm\u7684\u52a8\u6001\u66f4\u65b0\u3002","title":"\u914d\u7f6e\u90e8\u5206"},{"location":"#_9","text":"\u5728\u5b8c\u6210\u4e0a\u8ff0\u914d\u7f6e\u540e\uff0c\u5728\u7f16\u5199\u6784\u5efa\u955c\u50cf\u7684\u6d41\u6c34\u7ebf\u53ef\u8bbe\u7f6e\u7f13\u5b58\u7684\u4f4d\u7f6e\u3002\u53ef\u8bbe\u7f6e\u7f13\u5b58\u7684cache key\u548cpaths\u6765\u6307\u5b9a\u7f13\u5b58\u8def\u5f84\u3002 build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ \u6d41\u6c34\u7ebf\u5728\u8fd0\u884c\u65f6\u5982\u6709\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5219\u4ee3\u8868\u6784\u5efa\u4f7f\u7528\u4e86\u7f13\u5b58 \u6d41\u6c34\u7ebf\u7f13\u5b58\u8be6\u7ec6\u6587\u6863\u53ef\u53c2\u8003 \u6587\u6863","title":"\u4f7f\u7528\u90e8\u5206"},{"location":"#hparunner-manager","text":"\u670d\u52a1\u521b\u5efa\u754c\u9762\u5df2\u9ed8\u8ba4\u51c6\u5907\u4e86\u4e00\u4e2aHPA\u89c4\u5219 hpa: minReplicas: 2 maxReplicas: 10 metrics: - type: Resource resource: name: cpu target: averageUtilization: 10 type: Utilization \u76f8\u5e94\u5730\u89e3\u91ca\u5982\u4e0b\uff1a minReplicas: 2\uff1a\u6700\u5c0f\u526f\u672c\u6570\u4e3a2\u3002\u8fd9\u610f\u5473\u7740\u5373\u4f7f\u8d1f\u8f7d\u5f88\u4f4e\uff0cDeployment \u4e5f\u81f3\u5c11\u4f1a\u4fdd\u6301\u8fd0\u884c 2 \u4e2a\u526f\u672c\u3002 maxReplicas: 10\uff1a\u6700\u5927\u526f\u672c\u6570\u4e3a10\u3002\u8fd9\u662f HPA \u5728\u81ea\u52a8\u6269\u5c55\u65f6\u53ef\u4ee5\u589e\u52a0\u5230\u7684\u6700\u9ad8\u526f\u672c\u6570\u91cf\uff0c\u4ee5\u5e94\u5bf9\u9ad8\u8d1f\u8f7d\u3002 target.averageValue: 10\uff1a\u76ee\u6807\u5e73\u5747\u503c\u4e3a10%\u3002\u8fd9\u610f\u5473\u7740 HPA \u5c06\u5c1d\u8bd5\u4fdd\u6301\u6bcf\u4e2a CPU\u4e0a\u7684 CPU\u6307\u6807\u7684\u5e73\u5747\u503c\u4e3a 2\u3002\u5982\u679c\u6bcf\u4e2a Pod \u7684\u4f5c\u4e1a\u6570\u9ad8\u4e8e 2\uff0cHPA \u5c06\u503e\u5411\u4e8e\u589e\u52a0\u526f\u672c\uff1b\u5982\u679c\u4f4e\u4e8e 2\uff0cHPA \u5c06\u51cf\u5c11\u526f\u672c\uff0c\u4f46\u4e0d\u4f1a\u4f4e\u4e8e minReplicas \u7684\u8bbe\u7f6e\u3002 \u8fd9\u4e9b\u914d\u7f6e\u610f\u5473\u7740\uff0cHPA \u4f1a\u6839\u636eCPU\u5229\u7528\u7387\u6765\u8c03\u6574 Pod \u7684\u6570\u91cf\uff0c\u786e\u4fdd\u5728 2 \u5230 10 \u4e2a\u526f\u672c\u4e4b\u95f4\u52a8\u6001\u8c03\u6574\u4ee5\u6ee1\u8db3\u5904\u7406\u9700\u6c42\u3002 \u66f4\u591aHPA\u6559\u7a0b\u89c1\uff1ahttps://help.aliyun.com/zh/ack/hpa","title":"\u901a\u8fc7\u914d\u7f6eHPA\u89c4\u5219\u5b9e\u73b0Runner Manager\u8282\u70b9\u52a8\u6001\u4f38\u7f29"},{"location":"#ackecispotworker","text":"\u9009\u62e9\u5bf9\u5e94\u7684ack\u96c6\u7fa4\uff0c\u8fd0\u7ef4\u7ba1\u7406->\u7ec4\u4ef6\u7ba1\u7406->\u5b89\u88c5ACK Virtual Node \u5f00\u542fECI\u5f39\u6027\u80fd\u529b\u3002\u540e\u7eedrunner\u7684job\u4f1a\u76f4\u63a5\u6267\u884c\u5728\u865a\u62df\u8282\u70b9\u4e0a \u5982\u679c\u9700\u8981\u8ba9runner manager\u8282\u70b9\u4e5f\u8fd0\u884c\u5728spot\u5b9e\u4f8b\u4e0a\uff0c\u53ef\u53c2\u8003\u5982\u4e0b\u914d\u7f6e\u3002 \u901a\u8fc7\u6dfb\u52a0\u5982\u4e0b\u6ce8\u89e3\uff0c\u53ef\u4ee5\u8ba9ACK\u4e2d\u7684pod\u6ce8\u518c\u91c7\u7528\u865a\u62df\u8282\u70b9\u3002\u6ce8\u610f\u8be5\u53c2\u6570\u7684\u5c42\u7ea7\u4e0erunnerRegistrationToken\u76f8\u540c podLabels: alibabacloud.com/eci: \"true\" \u540c\u65f6\u9700\u8981\u5728runners\u7684config\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u914d\u7f6e\uff1a [runners.kubernetes.pod_labels] \"alibabacloud.com/compute-qos\" = \"best-effort\" \"alibabacloud.com/compute-class\" = \"general-purpose\" \"alibabacloud.com/eci\" = \"true\" \u5982\u56fe\u6240\u793a\uff1a \u8865\u5145\uff1a\u5982\u679c\u9009\u62e9\u4e3aACS\u96c6\u7fa4\uff0c\u5219\u8282\u70b9\u9ed8\u8ba4\u90fd\u4f1a\u5728\u865a\u62df\u8282\u70b9\u4e0a\uff0c\u65e0\u9700\u989d\u5916\u914d\u7f6e\u3002 \u5982\u679c\u9700\u8981\u8fdb\u4e00\u6b65\u9650\u5236runner manager\u6d88\u8017\u7684\u8d44\u6e90\uff0c\u53ef\u53c2\u8003\u5982\u4e0b\u8bbe\u7f6e\uff0c\u5c42\u7ea7\u4ecd\u4e3a\u6700\u5916\u5c42\uff1a resources: requests: cpu: \"250m\" memory: \"256Mi\" limits: cpu: \"1000m\" memory: \"512Mi\"","title":"ACK\u573a\u666f\u4e0b\u4f7f\u7528ECI+Spot\u5f39\u6027\u8fd0\u884cWorker\u8282\u7701\u6210\u672c"},{"location":"#_10","text":"","title":"\u955c\u50cf\u6784\u5efa\u793a\u4f8b"},{"location":"#gitlab-runner_1","text":"\u5982\u679c\u6ca1\u6709\u955c\u50cf\u4ed3\u5e93\u7684\u8bdd\uff0c\u53ef\u53c2\u8003\u963f\u91cc\u4e91\u7684acr\u670d\u52a1\u8fdb\u884c\u521b\u5efa\u3002 \u53c2\u8003\u6587\u6863\uff1ahttps://help.aliyun.com/zh/acr/user-guide/create-a-container-registry-enterprise-edition-instance?spm=a2c4g.11186623.help-menu-60716.d_2_0_0.7f991ecdmE3Nmr \u4f7f\u7528Gitlab runner\u7684\u4e00\u4e2a\u5e38\u7528\u573a\u666f\u4e3aDocker\u955c\u50cf\u7684\u6784\u5efa\u3002\u76ee\u524d\u901a\u7528\u7684\u65b9\u6848\u6709\u4e24\u79cd 1. Docker in Docker\u3002 2. kaniko \u7531\u4e8e\u4f7f\u7528kaniko\u53ef\u51cf\u5c11\u865a\u62df\u5316\u7684\u635f\u8017\uff0c\u6548\u7387\u66f4\u597d\uff0c\u56e0\u6b64\u6b64\u5904\u4ec5\u7ed9\u51fa\u7b2c\u4e8c\u79cd\u65b9\u6848\u7684\u793a\u4f8b\u3002 3. \u6ce8\u610f\u9700\u8981\u6307\u5b9a\u8fd0\u884c\u7684\u955c\u50cf\u4e3a\uff1aregistry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ image: name: registry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug entrypoint: [\"\"] script: - echo \"{\\\"auths\\\":{\\\"${ACR_REGISTRY}\\\":{\\\"auth\\\":\\\"$(printf \"%s:%s\" \"${CI_REGISTRY_USER}\" \"${CI_REGISTRY_PASSWORD}\" | base64 | tr -d '\\n')\\\"}}}\" > /kaniko/.docker/config.json - /kaniko/executor --context \"$CI_PROJECT_DIR\" --dockerfile \"$CI_PROJECT_DIR/Dockerfile\" --destination ${ACR_REGISTRY}:latest \u8bf4\u660e\uff1a CI_REGISTRY_USER\uff0cCI_REGISTRY_PASSWORD\uff0cACR_REGISTRY\u53c2\u6570\u4e3aSecret\u6216\u8005\u73af\u5883\u53d8\u91cf\u3002\u53ef\u5728\u6b64\u5904\u6dfb\u52a0\uff1a $CI_PROJECT_DIR\u4ee3\u8868\u5f53\u524d\u9879\u76ee\u8def\u5f84\u3002 \u5176\u4e2d\u53c2\u6570--context\u4ee3\u8868\u6784\u5efa\u7684\u76ee\u5f55 --destination\u4ee3\u8868\u955c\u50cf\u4ed3\u5e93\u5730\u5740\u3002 \u66f4\u591akaniko\u53c2\u6570\u53ef\u53c2\u8003\uff1ahttps://github.com/GoogleContainerTools/kaniko","title":"\u5c06Gitlab runner\u6784\u5efa\u7684\u955c\u50cf\u4e0a\u4f20\u5230\u955c\u50cf\u4ed3\u5e93"},{"location":"#_11","text":"\u6ce8\u610f \uff1a\u6b64\u5904\u7684\u7f13\u5b58\u6307\u4f7f\u7528kaniko\u6784\u5efa\u955c\u50cf\u65f6\u5f00\u542f\u955c\u50cf\u4e0d\u540c\u5c42\u4e4b\u95f4\u7684\u7f13\u5b58\u3002 \u5982\u679c\u91c7\u7528\u4e86\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u53ef\u53c2\u8003\u4e0b\u5217\u8bbe\u7f6e\u76f4\u63a5\u5f00\u542f\u955c\u50cf\u6784\u5efa\u65f6\u7684\u52a0\u901f\u3002 caching Layers \uff1akaniko \u53ef\u4ee5\u5728\u8fdc\u7a0b\u5b58\u50a8\u5e93\u4e2d\u7f13\u5b58\u7531RUN\uff08\u7531flag\u2013cache-RUN-layers\u914d\u7f6e\uff09\u548cCOPY\uff08\u7531flag\u2013cache-COPY-layeers\u914d\u7f6e\uff09\u547d\u4ee4\u521b\u5efa\u7684\u5c42\u3002 \u5728\u6267\u884c\u547d\u4ee4\u4e4b\u524d kaniko \u4f1a\u68c0\u67e5\u5f53\u524d\u5c42\u7684\u7f13\u5b58\u5e76\u5229\u7528 \u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e --cache=true \u6807\u5fd7\u9009\u62e9\u7f13\u5b58,\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7--cache-repo \u6807\u5fd7\u63d0\u4f9b\u7528\u4e8e\u5b58\u50a8\u7f13\u5b58\u5c42\u7684\u8fdc\u7a0b\u5b58\u50a8\u5e93, \u5982\u679c\u672a\u63d0\u4f9b\u6b64\u6807\u5fd7\u5219\u5c06\u4ece\u63d0\u4f9b\u7684--destination\u63a8\u65ad\u7f13\u5b58\u7684repo\u3002 \u4e00\u4e2a\u4f7f\u7528\u4e86kaniko\u7f13\u5b58\u7684\u793a\u4f8b\u53ef\u53c2\u8003\uff1a script: - echo \"{\\\"auths\\\":{\\\"${ACR_REGISTRY}\\\":{\\\"auth\\\":\\\"$(printf \"%s:%s\" \"${CI_REGISTRY_USER}\" \"${CI_REGISTRY_PASSWORD}\" | base64 | tr -d '\\n')\\\"}}}\" > /kaniko/.docker/config.json - /kaniko/executor --context \"$CI_PROJECT_DIR\" --dockerfile \"$CI_PROJECT_DIR/Dockerfile\" --destination ${ACR_REGISTRY}:latest --cache=true \u8fd9\u91cc\u6700\u540e\u7ed9\u51fa\u4e00\u4e2a\u5b8c\u6574\u53ef\u4ee5\u4f7f\u7528\u7684runner\u914d\u7f6e\uff1a stages: # List of stages for jobs, and their order of execution - build - test - deploy variables: KUBERNETES_POD_LABELS_1: \"alibabacloud.com/compute-class=general-purpose\" KUBERNETES_POD_LABELS_2: \"alibabacloud.com/compute-qos=best-effort\" build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ image: name: registry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug entrypoint: [\"\"] script: - echo \"{\\\"auths\\\":{\\\"${ACR_REGISTRY}\\\":{\\\"auth\\\":\\\"$(printf \"%s:%s\" \"${CI_REGISTRY_USER}\" \"${CI_REGISTRY_PASSWORD}\" | base64 | tr -d '\\n')\\\"}}}\" > /kaniko/.docker/config.json - /kaniko/executor --context \"$CI_PROJECT_DIR\" --dockerfile \"$CI_PROJECT_DIR/Dockerfile\" --destination ${ACR_REGISTRY}:latest --cache=true","title":"\u955c\u50cf\u6784\u5efa\u7f13\u5b58\u914d\u7f6e"},{"location":"#values","text":"https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml \u53ef\u57fa\u4e8e\u6b64\u5b9e\u73b0\u4e00\u4e9b\u66f4\u9ad8\u9636\u7684\u914d\u7f6e\uff0c\u6bd4\u5982\u901a\u8fc7Hpa\u5b9e\u73b0Runner manager\u8282\u70b9\u7684\u52a8\u6001\u6269\u7f29\u5bb9\u3002 Gitlab Runner\u7684\u5b98\u65b9\u914d\u7f6e\u6587\u6863\u53c2\u8003\uff1ahttps://gitlab.cn/docs/runner/configuration/","title":"\u5b8c\u6574Values\u53c2\u8003"},{"location":"index-en/","text":"Gitlab Runner Disclaimer: This service is provided by a third party. While we endeavor to ensure its security, accuracy, and reliability, we cannot guarantee that it will be entirely free from malfunctions, interruptions, errors, or attacks. Therefore, the company hereby declares: we make no representations, guarantees, or commitments regarding the content, accuracy, completeness, reliability, suitability, or timeliness of this service, and we disclaim any responsibility for any direct or indirect losses or damages that may result from your use of this service; we are not responsible for the content, accuracy, completeness, reliability, suitability, or timeliness of any third-party websites, applications, products, and services that you access through this service, and you assume the risk and responsibility for the consequences of their use; we are not liable for any losses or damages resulting from your use of this service, including but not limited to direct losses, indirect losses, loss of profits, loss of goodwill, loss of data, or other economic losses, even if we have been advised in advance of the possibility of such losses or damages. We reserve the right to modify this disclaimer from time to time, so please check it periodically before using this service. If you have any questions or concerns about this disclaimer or this service, please contact us. Overview JiHu GitLab Runner executes CI/CD jobs defined in JiHu GitLab. JiHu GitLab Runner can run as a single binary, with no language-specific requirements. JiHu GitLab Runner features include the following: Running multiple jobs in parallel. Using multiple tokens (even per project) on multiple servers. Limiting the number of concurrent jobs per token. Jobs can be run in the following environments: Locally. Using Docker containers. Using Docker containers with jobs executed via SSH. Using elastic-scaled Docker containers on various cloud and virtualization platforms. Connected to a remote SSH server. Written in Go and distributed as a single binary with no additional requirements. Supports Bash, PowerShell Core, and Windows PowerShell. Suitable for GNU/Linux, macOS, and Windows (almost any environment that can run Docker). Allows customization of job-running environments. Automatically reloads configuration without needing a restart. Easy-to-use setup supports for Docker, Docker-SSH, Parallels, or SSH running environments. Enables caching of Docker containers. Easily installable as a service for GNU/Linux, macOS, and Windows. Embedded Prometheus metrics HTTP server. Supports monitoring and passing Prometheus metrics and other job-specific data to JiHu GitLab. This service can rapidly request runner pods based on the features of Alibaba Cloud Container Virtual Node, significantly reducing costs. The default virtual node type requested is: \"alibabacloud.com/compute-qos\" = \"best-effort\" \"alibabacloud.com/compute-class\" = \"general-purpose\" In actual use, the system requirements configuration for JiHu GitLab Runner depends on: The CPU load required by the CI/CD jobs. The memory usage required by the CI/CD jobs. The number of concurrent CI/CD jobs. The number of projects under development. The number of developers expected to work simultaneously. Prerequisites Deploying the Gitlab Runner Community Edition service instance requires access and the ability to create certain Alibaba Cloud resources. Therefore, your account needs to include permissions for the following resources. Note : These permissions need to be added only if your account is a RAM account. Permission Policy Name Remarks AliyunECSFullAccess Permission to manage Elastic Compute Service (ECS) AliyunVPCFullAccess Permission to manage Virtual Private Cloud (VPC) AliyunROSFullAccess Permission to manage Resource Orchestration Service (ROS) AliyunComputeNestUserFullAccess Permission to manage Compute Nest Services from a user-side perspective AliyunComputeOSSFullAccess Permission to manage Object Storage Service (OSS) AliyunCSFullAccess Permission to manage Container Service (CS) Billing Information The costs associated with deploying the Community Edition on Compute Nest mainly involve: The selected vCPU and memory specifications System disk type and capacity Public bandwidth Deployment Architecture Deployment Parameters When creating a service instance, you need to configure the service instance information. The following outlines the detailed information of Jupyterhub service instance input parameters, divided into existing ACK clusters and new ACK clusters. Existing ACK Cluster When the parameter \"Create new ACK cluster\" is set to no, it means you already have an ACK cluster, and the following parameters need to be filled out. Parameter Group Parameter Example Description Service Instance Name test Name of the instance Region East China 1 (Hangzhou) Select the region of the service instance, preferably close by for better network latency. Create new ACK cluster Yes/No No Selecting No indicates an existing ACK cluster, no need to create a new one Create new ACK cluster K8s Cluster ID ccde6deb0f612402786e611a7e1230d Select the ID of an existing cluster within the region Application Configuration Domain jupyter.mycompany.com The domain to access Application Configuration Helm Configuration {} Detailed Helm configuration reference: https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml New ACK Cluster Parameter Group Parameter Example Description Service Instance Name test Name of the instance Region East China 1 (Hangzhou) Select the region of the service instance, preferably close by for better network latency. Create new ACK cluster Yes Selecting Yes indicates creating a new ACK cluster Billing Type Configuration Billing Type Pay-As-You-Go or Subscription Basic Configuration Availability Zone Zone I Different availability zones within the region Basic Configuration VPC Instance ID vpc-xxx Select an available VPC within the region. If none exists, a new one can be created. Basic Configuration Subnet Instance ID vsw-xxx Select a subnet within the selected VPC, influenced by the availability zone. If none exists, a new one can be created. Basic Configuration Instance Password * * Set the instance password. The password must be between 8-30 characters and include three of the following: uppercase letters, lowercase letters, numbers, special characters from ()~!@#$%^&*-+={}[]:;'<>,.?/. Kubernetes Configuration Worker Node Specification ecs.g6.large Choose the ECS instance with the desired number of CPU cores and memory, to be used as a Kubernetes node Kubernetes Configuration Worker Node System Disk Type ESSD Cloud Disk Choose the system disk type for the Kubernetes cluster Worker nodes Kubernetes Configuration Worker Node System Disk Size (GB) 120 Set the system disk size for Worker nodes, measured in GB Kubernetes Configuration ACK Network Plugin Flannel Choose a network plugin for the ACK cluster, either Flannel or Terway, which affects the pod network settings below Kubernetes Configuration Pod Network CIDR 10.0.0.0/16 The Pod network range for ACK. Required when using Flannel. Please provide a valid private network segment, such as 10.0.0.0/8, 172.16-31.0.0/12-16, or 192.168.0.0/16, not overlapping with existing VPC or Kubernetes clusters. Kubernetes Configuration Pod Subnet Instance ID vsw-xx The Pod subnet instance ID for ACK. Required when using Terway. Choose a subnet with a mask no larger than 19. Kubernetes Configuration Service CIDR 172.16.0.0/16 The Service network range for ACK. Choose from: 10.0.0.0/16-24, 172.16-31.0.0/16-24, 192.168.0.0/16-24, ensuring no overlap with existing VPC or Kubernetes clusters. Application Configuration Domain jupyter.mycompany.com The domain to access Application Configuration Helm Configuration {} Detailed Helm configuration reference: https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml Deployment Process Visit the Compute Nest deployment link and fill in the deployment parameters as prompted. Specify whether to create a new cluster or select an existing one Fill in the Helm configuration . The first parameter is the namespace where the Helm application will run. The default value {\"Ref\":\"ALIYUN::StackName\"} means using the Compute Nest instance name as the namespace. The second parameter is the Chart values, which are the parameters needed to run the Helm application. Note that you must replace the GitlabUrl and GitlabRunnerToken here. GitlabUrl is the external address of your Gitlab, while GitlabRunnerToken is the token registered with Gitlab for the runner, used for authentication between Gitlab and Runner. Refer to the following two images to obtain the token: for creating a new Runner and An illustration of successfully creating a Runner registered with Gitlab is shown here. Note that once the current page is closed, the token cannot be viewed again: In the default configuration values, 'concurrent' represents the number of concurrent jobs. If you have not deployed your own Gitlab, you can use the official address by entering: https://gitlab.com. Note: Both the manager node of Gitlab Runner and the scheduled job nodes operate under {{.Release.Namespace}}. Please do not modify this configuration, or it will cause permission issues. For adjustments to other parameters, refer to the official documentation . Click to create immediately and wait for the service instance to be deployed Once the service instance deployment is complete, click on the instance ID to enter the detail page. As shown, the deployment has been successfully completed You can now proceed to create and execute pipelines in the original Gitlab. Advanced Configuration Dynamically Modify Helm Values (The Following Advanced Configurations Rely on This Functionality) Click to enter the service instance details page, then click \"Modify Configuration\" in the top right corner. Choose to modify the Helm configuration. Modify the deployment parameters and reconfigure. Wait for the instance to be reconfigured to achieve dynamic Helm updates. Configure OSS Cache for Pipeline Acceleration This cache is for pipeline job caching, such as caching Python dependencies. Configuration Section First, you need to create an OSS-related RAM user and grant this user OSS-related permissions, and save its Access Key (AK) and Secret Key (SK). You can refer to this document for related RAM AK and SK creation. Click to enter the service instance details page, then click \"Modify Configuration\" in the top right corner. Choose to modify the Helm configuration. Find the line [[runners]] , and add the following configuration in its sub-columns: [runners.cache] type = \"s3\" shared = true [runners.cache.s3] #example\uff1a\"oss-ap-southeast-1.aliyuncs.com\" ServerAddress = \"${ServerAddress}\" AccessKey = \"LTAxxxxx\" SecretKey = \"0KPDxxxx\" #example:\"gitlab-runner\" BucketName = \"${BucketName}\" #example:\"ap-southeast-1\" BucketLocation = \"${Region}\" Insecure = false Implement Dynamic Scaling of Runner Manager Nodes via HPA Configuration A default HPA rule is prepared in the service creation interface hpa: minReplicas: 2 maxReplicas: 10 metrics: - type: Resource resource: name: cpu target: averageUtilization: 10 type: Utilization The corresponding explanations are as follows: minReplicas: 2: The minimum number of replicas is set to 2. This means that even with low load, the Deployment will maintain at least 2 running replicas. maxReplicas: 10: The maximum number of replicas is set to 10. This is the highest number of replicas HPA can scale to automatically in response to high load. target.averageUtilization: 10: The target average utilization is set to 10%. This means that HPA will try to keep the average CPU metric at 10%. If the jobs per Pod exceed 10%, HPA will tend to increase the replicas; if lower than 10%, HPA will reduce the replicas but not below the minReplicas setting. These settings mean that HPA will adjust the number of Pods based on CPU utilization, ensuring dynamic scaling between 2 and 10 replicas to meet processing demands. More HPA tutorials can be found at: https://help.aliyun.com/zh/ack/hpa Using ECI + Spot for Cost-efficient Elastic Worker Nodes in ACK Scenarios Select the corresponding ACK cluster, go to Operations Management -> Component Management -> Install ACK Virtual Node to enable ECI elasticity. Subsequent runner jobs will be executed directly on virtual nodes. If you also want the runner manager nodes to run on spot instances, the following configuration can be utilized. By adding the following annotation, pods in ACK can register using virtual nodes. Note that the parameter level is the same as runnerRegistrationToken. podLabels: alibabacloud.com/eci: \"true\" As shown in the figure: Note: If ACS cluster is selected, nodes will default to virtual nodes without additional configuration required. To further limit the resources consumed by the runner manager, refer to the following settings, which remain at the top level: resources: requests: cpu: \"250m\" memory: \"256Mi\" limits: cpu: \"1000m\" memory: \"512Mi\" Image Build Example Uploading Images Built by Gitlab Runner to an Image Repository If you do not have an image repository, you can refer to Alibaba Cloud's ACR service to create one. Reference documentation: https://help.aliyun.com/zh/acr/user-guide/create-a-container-registry-enterprise-edition-instance?spm=a2c4g.11186623.help-menu-60716.d_2_0_0.7f991ecdmE3Nmr A common scenario for using Gitlab Runner is for Docker image building. Currently, two general solutions exist: 1. Docker in Docker. 2. Kaniko. Since Kaniko reduces virtualization overhead and performs more efficiently, only the second solution is exemplified here. 3. Note: Specify the running image as: registry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ image: name: registry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug entrypoint: [\"\"] script: - echo \"{\\\"auths\\\":{\\\"${ACR_REGISTRY}\\\":{\\\"auth\\\":\\\"$(printf \"%s:%s\" \"${CI_REGISTRY_USER}\" \"${CI_REGISTRY_PASSWORD}\" | base64 | tr -d '\\n')\\\"}}}\" > /kaniko/.docker/config.json - /kaniko/executor --context \"$CI_PROJECT_DIR\" --dockerfile \"$CI_PROJECT_DIR/Dockerfile\" --destination ${ACR_REGISTRY}:latest Explanation: CI_REGISTRY_USER, CI_REGISTRY_PASSWORD, and ACR_REGISTRY are parameters set as secrets or environment variables. They can be added here: $CI_PROJECT_DIR represents the current project path. The parameter --context specifies the build directory. --destination specifies the image repository address. More Kaniko parameters can be referenced here: https://github.com/GoogleContainerTools/kaniko Image Build Cache Configuration This service instance has pre-installed OSS. When writing the pipeline for building images, you can set the cache location. You can specify cache keys and paths to determine the cache path. build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ Here is a complete runner configuration that can be used: stages: # List of stages for jobs, and their order of execution - build - test - deploy variables: KUBERNETES_POD_LABELS_1: \"alibabacloud.com/compute-class=general-purpose\" KUBERNETES_POD_LABELS_2: \"alibabacloud.com/compute-qos=best-effort\" build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ image: name: registry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug entrypoint: [\"\"] script: - echo \"{\\\"auths\\\":{\\\"${ACR_REGISTRY}\\\":{\\\"auth\\\":\\\"$(printf \"%s:%s\" \"${CI_REGISTRY_USER}\" \"${CI_REGISTRY_PASSWORD}\" | base64 | tr -d '\\n')\\\"}}}\" > /kaniko/.docker/config.json - /kaniko/executor --context \"$CI_PROJECT_DIR\" --dockerfile \"$CI_PROJECT_DIR/Dockerfile\" --destination ${ACR_REGISTRY}:latest Complete Values Reference https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml This can be used to implement more advanced configurations, such as enabling dynamic scaling of Runner manager nodes via HPA. Official configuration documentation for Gitlab Runner can be referenced here: https://gitlab.cn/docs/runner/configuration/","title":"Gitlab Runner"},{"location":"index-en/#gitlab-runner","text":"Disclaimer: This service is provided by a third party. While we endeavor to ensure its security, accuracy, and reliability, we cannot guarantee that it will be entirely free from malfunctions, interruptions, errors, or attacks. Therefore, the company hereby declares: we make no representations, guarantees, or commitments regarding the content, accuracy, completeness, reliability, suitability, or timeliness of this service, and we disclaim any responsibility for any direct or indirect losses or damages that may result from your use of this service; we are not responsible for the content, accuracy, completeness, reliability, suitability, or timeliness of any third-party websites, applications, products, and services that you access through this service, and you assume the risk and responsibility for the consequences of their use; we are not liable for any losses or damages resulting from your use of this service, including but not limited to direct losses, indirect losses, loss of profits, loss of goodwill, loss of data, or other economic losses, even if we have been advised in advance of the possibility of such losses or damages. We reserve the right to modify this disclaimer from time to time, so please check it periodically before using this service. If you have any questions or concerns about this disclaimer or this service, please contact us.","title":"Gitlab Runner"},{"location":"index-en/#overview","text":"JiHu GitLab Runner executes CI/CD jobs defined in JiHu GitLab. JiHu GitLab Runner can run as a single binary, with no language-specific requirements. JiHu GitLab Runner features include the following: Running multiple jobs in parallel. Using multiple tokens (even per project) on multiple servers. Limiting the number of concurrent jobs per token. Jobs can be run in the following environments: Locally. Using Docker containers. Using Docker containers with jobs executed via SSH. Using elastic-scaled Docker containers on various cloud and virtualization platforms. Connected to a remote SSH server. Written in Go and distributed as a single binary with no additional requirements. Supports Bash, PowerShell Core, and Windows PowerShell. Suitable for GNU/Linux, macOS, and Windows (almost any environment that can run Docker). Allows customization of job-running environments. Automatically reloads configuration without needing a restart. Easy-to-use setup supports for Docker, Docker-SSH, Parallels, or SSH running environments. Enables caching of Docker containers. Easily installable as a service for GNU/Linux, macOS, and Windows. Embedded Prometheus metrics HTTP server. Supports monitoring and passing Prometheus metrics and other job-specific data to JiHu GitLab. This service can rapidly request runner pods based on the features of Alibaba Cloud Container Virtual Node, significantly reducing costs. The default virtual node type requested is: \"alibabacloud.com/compute-qos\" = \"best-effort\" \"alibabacloud.com/compute-class\" = \"general-purpose\" In actual use, the system requirements configuration for JiHu GitLab Runner depends on: The CPU load required by the CI/CD jobs. The memory usage required by the CI/CD jobs. The number of concurrent CI/CD jobs. The number of projects under development. The number of developers expected to work simultaneously.","title":"Overview"},{"location":"index-en/#prerequisites","text":"Deploying the Gitlab Runner Community Edition service instance requires access and the ability to create certain Alibaba Cloud resources. Therefore, your account needs to include permissions for the following resources. Note : These permissions need to be added only if your account is a RAM account. Permission Policy Name Remarks AliyunECSFullAccess Permission to manage Elastic Compute Service (ECS) AliyunVPCFullAccess Permission to manage Virtual Private Cloud (VPC) AliyunROSFullAccess Permission to manage Resource Orchestration Service (ROS) AliyunComputeNestUserFullAccess Permission to manage Compute Nest Services from a user-side perspective AliyunComputeOSSFullAccess Permission to manage Object Storage Service (OSS) AliyunCSFullAccess Permission to manage Container Service (CS)","title":"Prerequisites"},{"location":"index-en/#billing-information","text":"The costs associated with deploying the Community Edition on Compute Nest mainly involve: The selected vCPU and memory specifications System disk type and capacity Public bandwidth","title":"Billing Information"},{"location":"index-en/#deployment-architecture","text":"","title":"Deployment Architecture"},{"location":"index-en/#deployment-parameters","text":"When creating a service instance, you need to configure the service instance information. The following outlines the detailed information of Jupyterhub service instance input parameters, divided into existing ACK clusters and new ACK clusters.","title":"Deployment Parameters"},{"location":"index-en/#existing-ack-cluster","text":"When the parameter \"Create new ACK cluster\" is set to no, it means you already have an ACK cluster, and the following parameters need to be filled out. Parameter Group Parameter Example Description Service Instance Name test Name of the instance Region East China 1 (Hangzhou) Select the region of the service instance, preferably close by for better network latency. Create new ACK cluster Yes/No No Selecting No indicates an existing ACK cluster, no need to create a new one Create new ACK cluster K8s Cluster ID ccde6deb0f612402786e611a7e1230d Select the ID of an existing cluster within the region Application Configuration Domain jupyter.mycompany.com The domain to access Application Configuration Helm Configuration {} Detailed Helm configuration reference: https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml","title":"Existing ACK Cluster"},{"location":"index-en/#new-ack-cluster","text":"Parameter Group Parameter Example Description Service Instance Name test Name of the instance Region East China 1 (Hangzhou) Select the region of the service instance, preferably close by for better network latency. Create new ACK cluster Yes Selecting Yes indicates creating a new ACK cluster Billing Type Configuration Billing Type Pay-As-You-Go or Subscription Basic Configuration Availability Zone Zone I Different availability zones within the region Basic Configuration VPC Instance ID vpc-xxx Select an available VPC within the region. If none exists, a new one can be created. Basic Configuration Subnet Instance ID vsw-xxx Select a subnet within the selected VPC, influenced by the availability zone. If none exists, a new one can be created. Basic Configuration Instance Password * * Set the instance password. The password must be between 8-30 characters and include three of the following: uppercase letters, lowercase letters, numbers, special characters from ()~!@#$%^&*-+={}[]:;'<>,.?/. Kubernetes Configuration Worker Node Specification ecs.g6.large Choose the ECS instance with the desired number of CPU cores and memory, to be used as a Kubernetes node Kubernetes Configuration Worker Node System Disk Type ESSD Cloud Disk Choose the system disk type for the Kubernetes cluster Worker nodes Kubernetes Configuration Worker Node System Disk Size (GB) 120 Set the system disk size for Worker nodes, measured in GB Kubernetes Configuration ACK Network Plugin Flannel Choose a network plugin for the ACK cluster, either Flannel or Terway, which affects the pod network settings below Kubernetes Configuration Pod Network CIDR 10.0.0.0/16 The Pod network range for ACK. Required when using Flannel. Please provide a valid private network segment, such as 10.0.0.0/8, 172.16-31.0.0/12-16, or 192.168.0.0/16, not overlapping with existing VPC or Kubernetes clusters. Kubernetes Configuration Pod Subnet Instance ID vsw-xx The Pod subnet instance ID for ACK. Required when using Terway. Choose a subnet with a mask no larger than 19. Kubernetes Configuration Service CIDR 172.16.0.0/16 The Service network range for ACK. Choose from: 10.0.0.0/16-24, 172.16-31.0.0/16-24, 192.168.0.0/16-24, ensuring no overlap with existing VPC or Kubernetes clusters. Application Configuration Domain jupyter.mycompany.com The domain to access Application Configuration Helm Configuration {} Detailed Helm configuration reference: https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml","title":"New ACK Cluster"},{"location":"index-en/#deployment-process","text":"Visit the Compute Nest deployment link and fill in the deployment parameters as prompted. Specify whether to create a new cluster or select an existing one Fill in the Helm configuration . The first parameter is the namespace where the Helm application will run. The default value {\"Ref\":\"ALIYUN::StackName\"} means using the Compute Nest instance name as the namespace. The second parameter is the Chart values, which are the parameters needed to run the Helm application. Note that you must replace the GitlabUrl and GitlabRunnerToken here. GitlabUrl is the external address of your Gitlab, while GitlabRunnerToken is the token registered with Gitlab for the runner, used for authentication between Gitlab and Runner. Refer to the following two images to obtain the token: for creating a new Runner and An illustration of successfully creating a Runner registered with Gitlab is shown here. Note that once the current page is closed, the token cannot be viewed again: In the default configuration values, 'concurrent' represents the number of concurrent jobs. If you have not deployed your own Gitlab, you can use the official address by entering: https://gitlab.com. Note: Both the manager node of Gitlab Runner and the scheduled job nodes operate under {{.Release.Namespace}}. Please do not modify this configuration, or it will cause permission issues. For adjustments to other parameters, refer to the official documentation . Click to create immediately and wait for the service instance to be deployed Once the service instance deployment is complete, click on the instance ID to enter the detail page. As shown, the deployment has been successfully completed You can now proceed to create and execute pipelines in the original Gitlab.","title":"Deployment Process"},{"location":"index-en/#advanced-configuration","text":"","title":"Advanced Configuration"},{"location":"index-en/#dynamically-modify-helm-values-the-following-advanced-configurations-rely-on-this-functionality","text":"Click to enter the service instance details page, then click \"Modify Configuration\" in the top right corner. Choose to modify the Helm configuration. Modify the deployment parameters and reconfigure. Wait for the instance to be reconfigured to achieve dynamic Helm updates.","title":"Dynamically Modify Helm Values (The Following Advanced Configurations Rely on This Functionality)"},{"location":"index-en/#configure-oss-cache-for-pipeline-acceleration","text":"This cache is for pipeline job caching, such as caching Python dependencies.","title":"Configure OSS Cache for Pipeline Acceleration"},{"location":"index-en/#configuration-section","text":"First, you need to create an OSS-related RAM user and grant this user OSS-related permissions, and save its Access Key (AK) and Secret Key (SK). You can refer to this document for related RAM AK and SK creation. Click to enter the service instance details page, then click \"Modify Configuration\" in the top right corner. Choose to modify the Helm configuration. Find the line [[runners]] , and add the following configuration in its sub-columns: [runners.cache] type = \"s3\" shared = true [runners.cache.s3] #example\uff1a\"oss-ap-southeast-1.aliyuncs.com\" ServerAddress = \"${ServerAddress}\" AccessKey = \"LTAxxxxx\" SecretKey = \"0KPDxxxx\" #example:\"gitlab-runner\" BucketName = \"${BucketName}\" #example:\"ap-southeast-1\" BucketLocation = \"${Region}\" Insecure = false","title":"Configuration Section"},{"location":"index-en/#implement-dynamic-scaling-of-runner-manager-nodes-via-hpa-configuration","text":"A default HPA rule is prepared in the service creation interface hpa: minReplicas: 2 maxReplicas: 10 metrics: - type: Resource resource: name: cpu target: averageUtilization: 10 type: Utilization The corresponding explanations are as follows: minReplicas: 2: The minimum number of replicas is set to 2. This means that even with low load, the Deployment will maintain at least 2 running replicas. maxReplicas: 10: The maximum number of replicas is set to 10. This is the highest number of replicas HPA can scale to automatically in response to high load. target.averageUtilization: 10: The target average utilization is set to 10%. This means that HPA will try to keep the average CPU metric at 10%. If the jobs per Pod exceed 10%, HPA will tend to increase the replicas; if lower than 10%, HPA will reduce the replicas but not below the minReplicas setting. These settings mean that HPA will adjust the number of Pods based on CPU utilization, ensuring dynamic scaling between 2 and 10 replicas to meet processing demands. More HPA tutorials can be found at: https://help.aliyun.com/zh/ack/hpa","title":"Implement Dynamic Scaling of Runner Manager Nodes via HPA Configuration"},{"location":"index-en/#using-eci-spot-for-cost-efficient-elastic-worker-nodes-in-ack-scenarios","text":"Select the corresponding ACK cluster, go to Operations Management -> Component Management -> Install ACK Virtual Node to enable ECI elasticity. Subsequent runner jobs will be executed directly on virtual nodes. If you also want the runner manager nodes to run on spot instances, the following configuration can be utilized. By adding the following annotation, pods in ACK can register using virtual nodes. Note that the parameter level is the same as runnerRegistrationToken. podLabels: alibabacloud.com/eci: \"true\" As shown in the figure: Note: If ACS cluster is selected, nodes will default to virtual nodes without additional configuration required. To further limit the resources consumed by the runner manager, refer to the following settings, which remain at the top level: resources: requests: cpu: \"250m\" memory: \"256Mi\" limits: cpu: \"1000m\" memory: \"512Mi\"","title":"Using ECI + Spot for Cost-efficient Elastic Worker Nodes in ACK Scenarios"},{"location":"index-en/#image-build-example","text":"","title":"Image Build Example"},{"location":"index-en/#uploading-images-built-by-gitlab-runner-to-an-image-repository","text":"If you do not have an image repository, you can refer to Alibaba Cloud's ACR service to create one. Reference documentation: https://help.aliyun.com/zh/acr/user-guide/create-a-container-registry-enterprise-edition-instance?spm=a2c4g.11186623.help-menu-60716.d_2_0_0.7f991ecdmE3Nmr A common scenario for using Gitlab Runner is for Docker image building. Currently, two general solutions exist: 1. Docker in Docker. 2. Kaniko. Since Kaniko reduces virtualization overhead and performs more efficiently, only the second solution is exemplified here. 3. Note: Specify the running image as: registry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ image: name: registry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug entrypoint: [\"\"] script: - echo \"{\\\"auths\\\":{\\\"${ACR_REGISTRY}\\\":{\\\"auth\\\":\\\"$(printf \"%s:%s\" \"${CI_REGISTRY_USER}\" \"${CI_REGISTRY_PASSWORD}\" | base64 | tr -d '\\n')\\\"}}}\" > /kaniko/.docker/config.json - /kaniko/executor --context \"$CI_PROJECT_DIR\" --dockerfile \"$CI_PROJECT_DIR/Dockerfile\" --destination ${ACR_REGISTRY}:latest Explanation: CI_REGISTRY_USER, CI_REGISTRY_PASSWORD, and ACR_REGISTRY are parameters set as secrets or environment variables. They can be added here: $CI_PROJECT_DIR represents the current project path. The parameter --context specifies the build directory. --destination specifies the image repository address. More Kaniko parameters can be referenced here: https://github.com/GoogleContainerTools/kaniko","title":"Uploading Images Built by Gitlab Runner to an Image Repository"},{"location":"index-en/#image-build-cache-configuration","text":"This service instance has pre-installed OSS. When writing the pipeline for building images, you can set the cache location. You can specify cache keys and paths to determine the cache path. build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ Here is a complete runner configuration that can be used: stages: # List of stages for jobs, and their order of execution - build - test - deploy variables: KUBERNETES_POD_LABELS_1: \"alibabacloud.com/compute-class=general-purpose\" KUBERNETES_POD_LABELS_2: \"alibabacloud.com/compute-qos=best-effort\" build-job: # This job runs in the build stage, which runs first. stage: build cache: key: test paths: - node_modules/ - .cache/ image: name: registry.cn-hangzhou.aliyuncs.com/acs-demo-ns/kaniko-executor:v1.21.0-amd64-debug entrypoint: [\"\"] script: - echo \"{\\\"auths\\\":{\\\"${ACR_REGISTRY}\\\":{\\\"auth\\\":\\\"$(printf \"%s:%s\" \"${CI_REGISTRY_USER}\" \"${CI_REGISTRY_PASSWORD}\" | base64 | tr -d '\\n')\\\"}}}\" > /kaniko/.docker/config.json - /kaniko/executor --context \"$CI_PROJECT_DIR\" --dockerfile \"$CI_PROJECT_DIR/Dockerfile\" --destination ${ACR_REGISTRY}:latest","title":"Image Build Cache Configuration"},{"location":"index-en/#complete-values-reference","text":"https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/main/values.yaml This can be used to implement more advanced configurations, such as enabling dynamic scaling of Runner manager nodes via HPA. Official configuration documentation for Gitlab Runner can be referenced here: https://gitlab.cn/docs/runner/configuration/","title":"Complete Values Reference"}]}